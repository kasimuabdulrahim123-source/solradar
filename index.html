<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SolRadar ‚Äî Second Wave Hunter</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#04060d;--bg2:#080c18;--bg3:#0c1220;--border:#161f33;--border2:#1e2d47;--green:#0dff8c;--yellow:#ffc233;--red:#ff3d5a;--blue:#3d8eff;--purple:#9c5fff;--cyan:#00e5ff;--gold:#ffd700;--text:#dce8f5;--text2:#526180;--text3:#8a9ab5;}
*{margin:0;padding:0;box-sizing:border-box;}html,body{height:100%;overflow-x:hidden;}
body{font-family:'Manrope',sans-serif;background:var(--bg);color:var(--text);}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,0.012) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.012) 1px,transparent 1px);background-size:44px 44px;pointer-events:none;z-index:0;}
header{position:sticky;top:0;z-index:100;background:rgba(4,6,13,0.98);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.hinner{display:flex;align-items:center;justify-content:space-between;padding:0 14px;height:50px;}
.logo{font-family:'Bebas Neue',sans-serif;font-size:19px;letter-spacing:2px;color:var(--cyan);display:flex;align-items:center;gap:7px;}
.logo-dot{width:7px;height:7px;border-radius:50%;background:var(--cyan);animation:glow 2s infinite;}
@keyframes glow{0%,100%{box-shadow:0 0 4px var(--cyan),0 0 14px var(--cyan)}50%{box-shadow:0 0 8px var(--cyan),0 0 28px var(--cyan)}}
.hpills{display:flex;gap:3px;flex-wrap:wrap;}
.pill{display:flex;align-items:center;gap:3px;padding:3px 7px;border-radius:4px;background:var(--bg2);border:1px solid var(--border);font-family:'DM Mono',monospace;font-size:9px;color:var(--text3);}
.pill.g{border-color:rgba(13,255,140,0.25);color:var(--green);background:rgba(13,255,140,0.04);}
.pill.c{border-color:rgba(0,229,255,0.25);color:var(--cyan);}
.pill.y{border-color:rgba(255,194,51,0.25);color:var(--yellow);}
.pill.r{border-color:rgba(255,61,90,0.25);color:var(--red);}
.blink{animation:bl 1s step-end infinite;}@keyframes bl{50%{opacity:0}}
.scan-bar{height:2px;background:linear-gradient(90deg,transparent,var(--cyan),transparent);background-size:200%;animation:scan 2s linear infinite;}
@keyframes scan{from{background-position:-100% 0}to{background-position:100% 0}}
.criteria{display:flex;gap:3px;padding:5px 14px;background:rgba(0,229,255,0.015);border-bottom:1px solid var(--border);overflow-x:auto;}
.criteria::-webkit-scrollbar{height:0;}
.cr{padding:2px 7px;border-radius:10px;font-family:'DM Mono',monospace;font-size:8px;font-weight:700;white-space:nowrap;flex-shrink:0;background:rgba(13,255,140,0.07);border:1px solid rgba(13,255,140,0.2);color:var(--green);}
.mrow{display:flex;gap:4px;padding:5px 14px;border-bottom:1px solid var(--border);overflow-x:auto;align-items:center;}
.mrow::-webkit-scrollbar{height:0;}
.mri{display:flex;align-items:center;gap:4px;padding:3px 7px;border-radius:4px;background:var(--bg3);border:1px solid var(--border);font-family:'DM Mono',monospace;font-size:9px;flex-shrink:0;}
.mrl{color:var(--text2);}.mrv{font-weight:600;}
.up{color:var(--green)!important;}.dn{color:var(--red)!important;}.ne{color:var(--text3)!important;}
.mktpill{flex-shrink:0;margin-left:auto;padding:3px 9px;border-radius:4px;font-family:'DM Mono',monospace;font-size:9px;font-weight:700;}
.mp-g{background:rgba(13,255,140,0.07);border:1px solid rgba(13,255,140,0.3);color:var(--green);}
.mp-w{background:rgba(255,194,51,0.07);border:1px solid rgba(255,194,51,0.3);color:var(--yellow);}
.mp-b{background:rgba(255,61,90,0.07);border:1px solid rgba(255,61,90,0.3);color:var(--red);}
.summary{display:flex;gap:4px;padding:5px 14px;border-bottom:1px solid var(--border);overflow-x:auto;}
.sum-item{display:flex;flex-direction:column;align-items:center;padding:4px 10px;border-radius:5px;background:var(--bg3);border:1px solid var(--border);flex-shrink:0;}
.sum-v{font-family:'Bebas Neue',sans-serif;font-size:19px;color:var(--cyan);line-height:1;}
.sum-l{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);text-transform:uppercase;letter-spacing:.7px;margin-top:1px;}
.fbar{display:flex;align-items:center;gap:3px;padding:5px 14px;border-bottom:1px solid var(--border);flex-wrap:wrap;}
.ftitle{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:var(--cyan);}
.fb{padding:3px 7px;border-radius:3px;border:1px solid var(--border2);background:var(--bg3);color:var(--text3);font-size:8px;font-weight:700;font-family:'DM Mono',monospace;cursor:pointer;transition:all 0.12s;}
.fb:hover,.fb.act{border-color:var(--cyan);color:var(--cyan);background:rgba(0,229,255,0.06);}
.rbtn{margin-left:auto;padding:4px 11px;border-radius:4px;border:1px solid rgba(0,229,255,0.3);background:rgba(0,229,255,0.06);color:var(--cyan);font-family:'DM Mono',monospace;font-size:9px;cursor:pointer;font-weight:700;}
.cnt{padding:2px 6px;border-radius:8px;font-family:'DM Mono',monospace;font-size:8px;background:rgba(0,229,255,0.08);border:1px solid rgba(0,229,255,0.18);color:var(--cyan);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:10px;padding:10px 14px 20px;}
.card{background:var(--bg2);border:1px solid rgba(0,229,255,0.16);border-radius:10px;padding:11px;position:relative;overflow:hidden;animation:cIn 0.3s ease forwards;opacity:0;}
@keyframes cIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--cyan),transparent);}
.card:hover{transform:translateY(-2px);box-shadow:0 8px 26px rgba(0,229,255,0.07);transition:transform 0.15s,box-shadow 0.15s;}
.card.top{border-color:rgba(0,229,255,0.3);background:rgba(0,229,255,0.014);}
.abar{display:flex;align-items:center;gap:4px;padding:6px 8px;background:rgba(0,229,255,0.04);border:1px solid rgba(0,229,255,0.14);border-radius:6px;margin-bottom:9px;}
.btn-copy{padding:4px 9px;border-radius:4px;border:1px solid rgba(0,229,255,0.4);background:rgba(0,229,255,0.08);color:var(--cyan);font-family:'DM Mono',monospace;font-size:9px;font-weight:700;cursor:pointer;flex-shrink:0;}
.btn-dex{padding:4px 9px;border-radius:4px;border:1px solid rgba(13,255,140,0.4);background:rgba(13,255,140,0.06);color:var(--green);font-family:'DM Mono',monospace;font-size:9px;font-weight:700;text-decoration:none;flex-shrink:0;}
.ca-txt{font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;padding:2px 4px;}
.ct{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;}
.ctl{display:flex;align-items:center;gap:7px;}
.clogo{width:34px;height:34px;border-radius:50%;background:var(--bg3);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;}
.cname{font-weight:800;font-size:13px;}.ctick{font-family:'DM Mono',monospace;font-size:9px;color:var(--text2);margin-top:1px;}
.cmeta{font-family:'DM Mono',monospace;font-size:8px;color:var(--text3);margin-top:2px;}
.ctr{text-align:right;}.cscore{font-family:'Bebas Neue',sans-serif;font-size:26px;line-height:1;}
.ccat{font-family:'DM Mono',monospace;font-size:8px;font-weight:700;margin-top:1px;}
.pj{background:var(--bg3);border-radius:6px;padding:7px;margin-bottom:7px;border:1px solid var(--border);}
.pj-title{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px;}
.bars{display:flex;align-items:flex-end;gap:2px;height:28px;margin-bottom:5px;}
.bar{flex:1;border-radius:2px 2px 0 0;min-height:2px;}
.pj-row{display:flex;align-items:center;gap:4px;font-family:'DM Mono',monospace;font-size:9px;flex-wrap:wrap;}
.pj-peak{padding:2px 6px;border-radius:3px;background:rgba(13,255,140,0.1);color:var(--green);border:1px solid rgba(13,255,140,0.2);font-weight:700;}
.pj-now{padding:2px 6px;border-radius:3px;background:rgba(0,229,255,0.1);color:var(--cyan);border:1px solid rgba(0,229,255,0.2);font-weight:700;}
.pj-drop{color:var(--red);font-weight:700;}.pj-up{color:var(--green);font-weight:700;margin-left:auto;}
.sg3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:3px;margin-bottom:5px;}
.si{background:var(--bg3);border-radius:4px;padding:4px 5px;text-align:center;}
.sv{font-family:'DM Mono',monospace;font-size:11px;font-weight:500;}
.sl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-top:1px;text-transform:uppercase;}
.cg-box{padding:5px 7px;border-radius:5px;background:rgba(255,215,0,0.03);border:1px solid rgba(255,215,0,0.2);margin-bottom:5px;display:flex;align-items:center;gap:5px;flex-wrap:wrap;}
.cg-t{font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);font-weight:700;}
.cg-s{background:var(--bg3);border-radius:3px;padding:2px 5px;text-align:center;}
.cg-sv{font-family:'DM Mono',monospace;font-size:9px;font-weight:600;}.cg-sl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);}
.x-box{padding:5px 7px;border-radius:5px;margin-bottom:5px;}
.x-on{background:rgba(61,142,255,0.04);border:1px solid rgba(61,142,255,0.2);}
.x-off{background:rgba(82,97,128,0.04);border:1px solid var(--border);}
.x-t{font-family:'DM Mono',monospace;font-size:8px;font-weight:700;margin-bottom:2px;}
.x-d{font-family:'DM Mono',monospace;font-size:8px;color:var(--text3);}
.hbox{padding:5px 7px;border-radius:5px;background:var(--bg3);border:1px solid var(--border);margin-bottom:5px;}
.hbox-t{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;}
.hbar{display:flex;height:5px;border-radius:3px;overflow:hidden;margin-bottom:3px;}
.hbar-d{background:var(--green);}.hbar-m{background:var(--yellow);}.hbar-p{background:var(--red);}
.hverdict{font-family:'DM Mono',monospace;font-size:8px;font-weight:700;}
.hdesc{font-family:'DM Mono',monospace;font-size:7px;color:var(--text3);margin-top:1px;line-height:1.4;}
.sigs{display:flex;gap:2px;flex-wrap:wrap;margin-bottom:5px;}
.sig{padding:2px 5px;border-radius:3px;font-size:7px;font-weight:700;font-family:'DM Mono',monospace;}
.s-cg{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.2);}
.s-x{background:rgba(61,142,255,0.1);color:var(--blue);border:1px solid rgba(61,142,255,0.18);}
.s-dh{background:rgba(13,255,140,0.1);color:var(--green);border:1px solid rgba(13,255,140,0.18);}
.s-acc{background:rgba(0,229,255,0.1);color:var(--cyan);border:1px solid rgba(0,229,255,0.18);}
.s-buy{background:rgba(13,255,140,0.08);color:var(--green);border:1px solid rgba(13,255,140,0.15);}
.s-up{background:rgba(156,95,255,0.1);color:var(--purple);border:1px solid rgba(156,95,255,0.18);}
.tbox{padding:5px 7px;border-radius:5px;margin-bottom:5px;display:flex;align-items:flex-start;gap:5px;}
.tb-g{background:rgba(13,255,140,0.04);border:1px solid rgba(13,255,140,0.2);}
.tb-w{background:rgba(255,194,51,0.04);border:1px solid rgba(255,194,51,0.2);}
.tb-b{background:rgba(255,61,90,0.04);border:1px solid rgba(255,61,90,0.2);}
.t-action{font-family:'Bebas Neue',sans-serif;font-size:13px;line-height:1.2;}
.t-reason{font-family:'DM Mono',monospace;font-size:8px;color:var(--text3);line-height:1.4;flex:1;}
.posbox{padding:4px 7px;border-radius:4px;background:var(--bg3);border:1px solid var(--border2);margin-bottom:5px;display:flex;justify-content:space-between;}
.pos-l{font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);}
.pos-v{font-family:'DM Mono',monospace;font-size:9px;font-weight:700;}
.lrow{display:flex;gap:3px;flex-wrap:wrap;padding-top:6px;border-top:1px solid var(--border);margin-top:3px;}
.lnk{padding:3px 6px;border-radius:3px;border:1px solid var(--border2);color:var(--text3);font-size:8px;text-decoration:none;font-family:'DM Mono',monospace;white-space:nowrap;}
.lnk:hover{border-color:var(--cyan);color:var(--cyan);}
.lnk-p{border-color:rgba(156,95,255,0.3);color:var(--purple);}
.lnk-cg{border-color:rgba(255,215,0,0.3);color:var(--gold);}
.lnk-x{border-color:rgba(61,142,255,0.3);color:var(--blue);}
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:220px;gap:12px;padding:20px;}
.spin{width:30px;height:30px;border:2px solid var(--border2);border-top-color:var(--cyan);border-radius:50%;animation:sp 0.7s linear infinite;}
@keyframes sp{to{transform:rotate(360deg)}}
.ltxt{font-family:'DM Mono',monospace;font-size:10px;color:var(--text2);text-align:center;line-height:1.8;}
.nomatch{grid-column:1/-1;padding:24px;background:var(--bg2);border:1px solid rgba(255,194,51,0.2);border-radius:8px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text2);text-align:center;line-height:2;}
@media(max-width:700px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <div class="hinner">
    <div class="logo"><div class="logo-dot"></div>SECOND WAVE HUNTER</div>
    <div class="hpills">
      <div class="pill g"><span class="blink">‚óè</span>&nbsp;<span id="liveCount">Loading...</span></div>
      <div class="pill c">SOL <span id="solPx" style="margin-left:3px">$--</span></div>
      <div class="pill y">F&G <span id="fgVal" style="margin-left:3px">--</span></div>
      <div class="pill r">üåä <span id="wCount">0</span></div>
      <div class="pill" id="apiSt">‚ü≥</div>
      <div class="pill">‚è± <span id="cd">5:00</span></div>
    </div>
  </div>
  <div class="scan-bar"></div>
</header>
<div class="criteria">
  <span class="cr">ü¶é CoinGecko Check</span>
  <span class="cr">üìâ Big Dump Detected</span>
  <span class="cr">üí∞ MC $1K‚Äì$200K</span>
  <span class="cr">üìä Vol $10K‚Äì$500K</span>
  <span class="cr">ùïè X Handle</span>
  <span class="cr">‚è∞ Age 1h‚Äì720h</span>
  <span class="cr">üîÅ PumpSwap ¬∑ Raydium</span>
</div>
<div class="mrow">
  <div class="mri"><span class="mrl">SOL</span><span class="mrv" id="solFull">$--</span></div>
  <div class="mri"><span class="mrl">SOL 24h</span><span class="mrv" id="sol24">--</span></div>
  <div class="mri"><span class="mrl">BTC 24h</span><span class="mrv" id="btc24">--</span></div>
  <div class="mri"><span class="mrl">Fear/Greed</span><span class="mrv" id="fgFull">--</span></div>
  <div class="mri"><span class="mrl">Found</span><span class="mrv" id="foundCt" style="color:var(--cyan)">0</span></div>
  <div class="mri"><span class="mrl">CG Listed</span><span class="mrv" id="cgCt" style="color:var(--gold)">0</span></div>
  <div class="mktpill mp-w" id="mktPill">‚ü≥ Loading...</div>
</div>
<div class="summary">
  <div class="sum-item"><div class="sum-v" id="sTotal">0</div><div class="sum-l">Total</div></div>
  <div class="sum-item"><div class="sum-v" style="color:var(--green)" id="sEnter">0</div><div class="sum-l">Enter Now</div></div>
  <div class="sum-item"><div class="sum-v" style="color:var(--yellow)" id="sWatch">0</div><div class="sum-l">Watch</div></div>
  <div class="sum-item"><div class="sum-v" style="color:var(--gold)" id="sCG">0</div><div class="sum-l">CG Listed</div></div>
  <div class="sum-item"><div class="sum-v" style="color:var(--blue)" id="sX">0</div><div class="sum-l">X Active</div></div>
  <div class="sum-item"><div class="sum-v" style="color:var(--red)" id="sAvgDrop">--%</div><div class="sum-l">Avg Dump</div></div>
  <div class="sum-item"><div class="sum-v" style="color:var(--green)" id="sAvgUp">--x</div><div class="sum-l">To Peak</div></div>
</div>
<div class="fbar">
  <span class="ftitle">üåä Setups</span>
  <button class="fb act" onclick="filt('all',this)">ALL</button>
  <button class="fb" onclick="filt('cg',this)">ü¶é CG LISTED</button>
  <button class="fb" onclick="filt('x',this)">ùïè X ACTIVE</button>
  <button class="fb" onclick="filt('dh',this)">üíé DIAMOND HANDS</button>
  <span class="cnt" id="cntBadge">0 tokens</span>
  <button class="rbtn" onclick="doRefresh()">‚ü≥ Refresh</button>
</div>
<div id="main"></div>

<script>
const EMOJIS=['üåä','üî•','üíé','üöÄ','‚ö°','üê∏','ü§ñ','üêâ','üëë','ü¶Ö','üê≥','üéØ','‚≠ê','üèÜ','üåô','üí∞','ü¶ä','üêØ','üé™','üé≠'];
const elog=n=>EMOJIS[Math.abs([...n].reduce((a,c)=>a+c.charCodeAt(0),0))%EMOJIS.length];
const fmc=n=>{if(!n||isNaN(n))return'N/A';if(n>=1e6)return'$'+(n/1e6).toFixed(2)+'M';if(n>=1e3)return'$'+(n/1e3).toFixed(1)+'K';return'$'+Math.round(n);};
let tokens=[],activeF='all',market={solPrice:0,solChg:0,btcChg:0,fearGreed:50,fgLabel:'Neutral',timing:'warn',timingLabel:'‚ü≥ Loading...'},cdSecs=300;

function setMain(html){document.getElementById('main').innerHTML=html;}
function setTxt(t){setMain(`<div class="loading"><div class="spin"></div><div class="ltxt">${t}</div></div>`);}

async function fetchMarket(){
  try{
    const d=await fetch('/api/market').then(r=>r.json());
    market.solPrice=d.solPrice||0;market.solChg=d.solChg||0;market.btcChg=d.btcChg||0;
    market.fearGreed=d.fearGreed||50;market.fgLabel=d.fgLabel||'Neutral';
    const sol=market.solChg,fg=market.fearGreed;
    if(sol>=3&&fg>=60){market.timing='good';market.timingLabel='‚úÖ BULL ‚Äî Best window';}
    else if(sol>=0&&fg>=45){market.timing='good';market.timingLabel='‚úÖ STABLE ‚Äî Good entries';}
    else if(sol>=-2){market.timing='warn';market.timingLabel='‚ö†Ô∏è COOLING ‚Äî Wait for confirm';}
    else{market.timing='bad';market.timingLabel='üî¥ DUMPING ‚Äî Avoid entries';}
    document.getElementById('solPx').textContent='$'+market.solPrice.toFixed(2);
    document.getElementById('solFull').textContent='$'+market.solPrice.toFixed(2);
    const sc=document.getElementById('sol24');sc.textContent=(sol>=0?'+':'')+sol.toFixed(1)+'%';sc.className='mrv '+(sol>=1?'up':sol<=-1?'dn':'ne');
    const bc=document.getElementById('btc24');bc.textContent=(market.btcChg>=0?'+':'')+market.btcChg.toFixed(1)+'%';bc.className='mrv '+(market.btcChg>=1?'up':market.btcChg<=-1?'dn':'ne');
    document.getElementById('fgVal').textContent=market.fearGreed;
    document.getElementById('fgFull').textContent=market.fearGreed+' ‚Äî '+market.fgLabel;
    const mp=document.getElementById('mktPill');mp.textContent=market.timingLabel;mp.className='mktpill '+(market.timing==='good'?'mp-g':market.timing==='warn'?'mp-w':'mp-b');
  }catch(e){console.log('market err',e);}
}

async function fetchAll(){
  setTxt('Scanning DexScreener for second wave setups...<br><small style="opacity:0.5">Fetching via server</small>');
  document.getElementById('apiSt').textContent='‚ü≥';
  await fetchMarket();
  try{
    setTxt('Fetching pairs from server...');
    const d=await fetch('/api/pairs').then(r=>r.json());
    console.log('pairs result:',d);
    setTxt(`Found ${d.total} pairs ‚Üí ${d.filtered} match filters. Enriching...`);
    const pairs=d.pairs||[];
    if(!pairs.length){
      setMain(`<div class="grid"><div class="nomatch">üåä No second wave setups right now.<br>${d.total} pairs scanned ‚Äî ${d.filtered} passed basic filters.<br><br>Filters: MC $1K‚Äì$200K ¬∑ Vol $10K‚Äì$500K ¬∑ Dumped 50%+<br><br>Auto-refreshes every 5 minutes.</div></div>`);
      document.getElementById('apiSt').textContent='‚úÖ';
      document.getElementById('liveCount').textContent='0 tokens';
      document.getElementById('wCount').textContent='0';
      updateSummary();
      return;
    }
    const enriched=[];
    for(let i=0;i<Math.min(pairs.length,20);i++){
      setTxt(`Checking token ${i+1}/${Math.min(pairs.length,20)} on CoinGecko...`);
      const t=await enrichPair(pairs[i]);
      if(t)enriched.push(t);
    }
    enriched.sort((a,b)=>{const o={'BUY ZONE':0,'WATCHING':1,'WAIT':2};return(o[a.cat]||1)-(o[b.cat]||1)||b.score-a.score;});
    tokens=enriched;
    document.getElementById('apiSt').textContent='‚úÖ Live';
    document.getElementById('liveCount').textContent=tokens.length+' tokens';
    document.getElementById('wCount').textContent=tokens.length;
    updateSummary();
    renderGrid();
  }catch(e){
    console.error('fetchAll error:',e);
    setMain(`<div class="grid"><div class="nomatch">‚ùå Error fetching data: ${e.message}<br><br>Check console for details.</div></div>`);
    document.getElementById('apiSt').textContent='‚ùå Error';
  }
}

async function enrichPair(p){
  const addr=p.baseToken?.address||'';
  const name=p.baseToken?.name||'Unknown';
  const ticker=p.baseToken?.symbol||'???';
  const mc=+(p.marketCap)||+(p.fdv)||0;
  const v24=+(p.volume?.h24)||0,v1h=+(p.volume?.h1)||0;
  const liq=+(p.liquidity?.usd)||0;
  const ch24=+(p.priceChange?.h24)||0,ch1=+(p.priceChange?.h1)||0;
  const b1h=p.txns?.h1?.buys||0,s1h=p.txns?.h1?.sells||0;
  const b24=p.txns?.h24?.buys||0,s24=p.txns?.h24?.sells||0;
  const ageH=p.pairCreatedAt?(Date.now()-p.pairCreatedAt)/3600000:48;
  const ratio=1+(ch24/100);
  const peakMC=ratio>0&&ratio<1?mc/ratio:mc*2;
  const dropPct=Math.abs(Math.round(ch24));
  const upsideToPeak=Math.max(1,Math.round(peakMC/mc));
  const socials=p.info?.socials||[];
  const twitter=socials.find(s=>s.type==='twitter')?.url||'';
  const telegram=socials.find(s=>s.type==='telegram')?.url||'';
  const hasX=!!twitter;
  const xActive=hasX&&(+(p.volume?.h1)||0)>0;
  const dexUrl=p.url||`https://dexscreener.com/solana/${addr}`;
  let cg={listed:false};
  try{cg=await fetch(`/api/cg?addr=${addr}`).then(r=>r.json());}catch(e){}
  const dh=b1h>s1h?62:45,ph=b1h>s1h?10:30,mh=100-dh-ph;
  const psych={dh,mh,ph,verdict:dh>=55?'üíé DIAMOND HANDS':'‚öñÔ∏è MIXED',color:dh>=55?'var(--green)':'var(--yellow)',desc:dh>=55?'More buyers than sellers ‚Äî strong hands':'Watch for direction confirmation'};
  let score=40;
  if(cg.listed)score+=20;if(hasX)score+=10;if(xActive)score+=8;if(b1h>s1h)score+=8;if(ch1>0)score+=8;if(dropPct>=70)score+=6;
  const cat=score>=70?'BUY ZONE':score>=52?'WATCHING':'WAIT';
  const sol=market.solChg,fg=market.fearGreed;
  let ts=0;
  if(sol>=2)ts+=20;else if(sol>=0)ts+=10;else ts-=15;
  if(fg>=60)ts+=15;else if(fg>=40)ts+=5;else ts-=20;
  if(b1h>s1h)ts+=15;if(ch1>0)ts+=10;if(cg.listed)ts+=10;
  const timing=ts>=50?{action:'‚úÖ ENTER NOW',cls:'g',reason:`SOL ${sol>=0?'+':''}${sol.toFixed(1)}% ¬∑ F&G:${fg}${b1h>s1h?' ¬∑ More buyers':''}`}:ts>=20?{action:'üëÄ WATCH CLOSELY',cls:'w',reason:`F&G:${fg} ¬∑ SOL ${sol.toFixed(1)}%`}:{action:'üî¥ WAIT',cls:'b',reason:`Market weak ¬∑ F&G:${fg}`};
  let pct='Paper only',plabel='SPECULATIVE',pcol='var(--text2)';
  if(score>=75){pct='3‚Äì5%';plabel='HIGH CONVICTION';pcol='var(--green)';}
  else if(score>=62){pct='1‚Äì3%';plabel='NORMAL';pcol='var(--cyan)';}
  else if(score>=50){pct='0.5‚Äì1%';plabel='SMALL BET';pcol='var(--yellow)';}
  return{addr,name,ticker,logo:elog(name),mc,v24,v1h,liq,ch24,ch1,b1h,s1h,b24,s24,ageH:Math.round(ageH),ageLabel:ageH<48?Math.round(ageH)+'h':Math.round(ageH/24)+'d',peakMC,dropPct,upsideToPeak,boosts:p.boosts?.active||0,twitter,telegram,hasX,xActive,dexUrl,addrShort:addr?addr.slice(0,6)+'...'+addr.slice(-6):'???',cg,psych,score,cat,timing,pos:{pct,label:plabel,color:pcol}};
}

function renderGrid(){
  let list=[...tokens];
  if(activeF==='cg')list=list.filter(t=>t.cg?.listed);
  if(activeF==='x')list=list.filter(t=>t.hasX);
  if(activeF==='dh')list=list.filter(t=>t.psych?.dh>=55);
  document.getElementById('cntBadge').textContent=list.length+' tokens';
  if(!list.length){setMain(`<div class="grid"><div class="nomatch">No tokens match this filter. Try ALL.</div></div>`);return;}
  const grid=document.createElement('div');grid.className='grid';
  list.forEach((t,i)=>{const el=document.createElement('div');el.className='card'+(i<3?' top':'');el.style.animationDelay=(i*40)+'ms';el.innerHTML=cardHTML(t);grid.appendChild(el);});
  setMain('');document.getElementById('main').appendChild(grid);
}

function cardHTML(t){
  const sc=t.cat==='BUY ZONE'?'var(--cyan)':t.cat==='WATCHING'?'var(--yellow)':'var(--red)';
  const tc=t.timing.cls==='g'?'var(--green)':t.timing.cls==='w'?'var(--yellow)':'var(--red)';
  const bars=genBars(t.dropPct),maxB=Math.max(...bars);
  const barH=bars.map((v,i)=>{const h=Math.round((v/maxB)*26),isPeak=v===maxB,isRec=i>=bars.length-3;const col=isPeak?'rgba(13,255,140,0.8)':isRec?'rgba(0,229,255,0.65)':i<bars.length/2?'rgba(13,255,140,0.35)':'rgba(255,61,90,0.5)';return`<div class="bar" style="height:${h}px;background:${col}"></div>`;}).join('');
  return`
  <div class="abar">
    <button class="btn-copy" onclick="copyCA('${t.addr}',this)">üìã Copy CA</button>
    <a class="btn-dex" href="${t.dexUrl}" target="_blank">üìà DEX Chart</a>
    <span class="ca-txt" title="${t.addr}" onclick="copyCA('${t.addr}',this)">${t.addrShort}</span>
  </div>
  <div class="ct">
    <div class="ctl"><div class="clogo">${t.logo}</div><div><div class="cname">${t.name}</div><div class="ctick">$${t.ticker}</div><div class="cmeta">${t.ageLabel} old ¬∑ ${t.boosts>0?t.boosts+' boosts ¬∑ ':''}</div></div></div>
    <div class="ctr"><div class="cscore" style="color:${sc}">${t.score}</div><div class="ccat" style="color:${sc}">${t.cat}</div></div>
  </div>
  <div class="pj">
    <div class="pj-title">Pump Journey ‚Äî 24h</div>
    <div class="bars">${barH}</div>
    <div class="pj-row"><span class="pj-peak">Peak ~${fmc(t.peakMC)}</span><span style="color:var(--red)">‚Üí</span><span class="pj-now">Now ${fmc(t.mc)}</span><span class="pj-drop">-${t.dropPct}%</span><span class="pj-up">${t.upsideToPeak}x to peak</span></div>
  </div>
  <div class="sg3">
    <div class="si"><div class="sv" style="color:var(--cyan)">${fmc(t.mc)}</div><div class="sl">MC Now</div></div>
    <div class="si"><div class="sv" style="color:var(--green)">${fmc(t.v24)}</div><div class="sl">24h Vol</div></div>
    <div class="si"><div class="sv">${fmc(t.liq)}</div><div class="sl">Liquidity</div></div>
  </div>
  <div class="sg3">
    <div class="si"><div class="sv" style="color:var(--red)">${t.ch24.toFixed(0)}%</div><div class="sl">24h Chg</div></div>
    <div class="si"><div class="sv" style="color:${t.ch1>=0?'var(--green)':'var(--red)'}">${t.ch1>=0?'+':''}${t.ch1.toFixed(0)}%</div><div class="sl">1h Chg</div></div>
    <div class="si"><div class="sv">${t.b1h}/${t.s1h}</div><div class="sl">Buy/Sell 1h</div></div>
  </div>
  ${t.cg?.listed?`<div class="cg-box"><span class="cg-t">ü¶é COINGECKO ‚úÖ</span>${t.cg.rank?`<div class="cg-s"><div class="cg-sv" style="color:var(--gold)">#${t.cg.rank}</div><div class="cg-sl">Rank</div></div>`:''} ${t.cg.watchlist?`<div class="cg-s"><div class="cg-sv" style="color:var(--cyan)">${t.cg.watchlist.toLocaleString()}</div><div class="cg-sl">Watching</div></div>`:''}</div>`:`<div style="padding:3px 7px;border-radius:4px;border:1px solid var(--border);background:var(--bg3);font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);margin-bottom:5px">ü¶é Not on CoinGecko</div>`}
  <div class="x-box ${t.hasX?'x-on':'x-off'}"><div class="x-t" style="color:${t.hasX?'var(--blue)':'var(--text2)'}">ùïè ${t.xActive?'X ACTIVE':t.hasX?'X Handle Found':'No X Handle'}</div>${t.hasX?`<div class="x-d"><a href="${t.twitter}" target="_blank" style="color:var(--blue)">${t.twitter.split('/').pop()}</a>${t.boosts>0?' ¬∑ '+t.boosts+' boosts active':''}</div>`:''}</div>
  <div class="hbox"><div class="hbox-t">Holder Psychology</div><div class="hbar"><div class="hbar-d" style="width:${t.psych.dh}%"></div><div class="hbar-m" style="width:${t.psych.mh}%"></div><div class="hbar-p" style="width:${t.psych.ph}%"></div></div><div style="display:flex;justify-content:space-between;font-family:'DM Mono',monospace;font-size:7px;margin-bottom:3px"><span style="color:var(--green)">üíé ${t.psych.dh}%</span><span style="color:var(--yellow)">‚öñÔ∏è ${t.psych.mh}%</span><span style="color:var(--red)">üìÑ ${t.psych.ph}%</span></div><div class="hverdict" style="color:${t.psych.color}">${t.psych.verdict}</div><div class="hdesc">${t.psych.desc}</div></div>
  <div class="sigs">
    ${t.cg?.listed?'<span class="sig s-cg">ü¶é CG Listed</span>':''}
    ${t.hasX?'<span class="sig s-x">ùïè X Handle</span>':''}
    ${t.xActive?'<span class="sig s-x">ùïè X Active</span>':''}
    ${t.psych.dh>=55?'<span class="sig s-dh">üíé Diamond Hands</span>':''}
    ${t.b1h>t.s1h?'<span class="sig s-buy">üìà More Buyers</span>':''}
    ${t.boosts>0?`<span class="sig s-acc">üî• ${t.boosts} Boosts</span>`:''}
    <span class="sig s-up">${t.upsideToPeak}x to peak</span>
    ${t.ch1>0?'<span class="sig s-buy">üìà Recovering</span>':''}
  </div>
  <div class="tbox tb-${t.timing.cls}"><div style="font-size:14px">${t.timing.cls==='g'?'‚úÖ':t.timing.cls==='w'?'‚ö†Ô∏è':'üî¥'}</div><div style="flex:1"><div class="t-action" style="color:${tc}">${t.timing.action}</div><div class="t-reason">${t.timing.reason}</div></div></div>
  <div class="posbox"><span class="pos-l">üíº Position:</span><span class="pos-v" style="color:${t.pos.color}">${t.pos.pct} ‚Äî ${t.pos.label}</span></div>
  <div class="lrow">
    <a class="lnk lnk-p" href="https://pump.fun/coin/${t.addr}" target="_blank">üî• Pump</a>
    <a class="lnk" href="https://birdeye.so/token/${t.addr}" target="_blank">ü¶Ö Bird</a>
    <a class="lnk" href="https://solscan.io/token/${t.addr}" target="_blank">üîç Scan</a>
    <a class="lnk" href="https://rugcheck.xyz/tokens/${t.addr}" target="_blank">üõ°Ô∏è Rug</a>
    ${t.twitter?`<a class="lnk lnk-x" href="${t.twitter}" target="_blank">ùïè Twitter</a>`:''}
    ${t.telegram?`<a class="lnk" href="${t.telegram}" target="_blank">üí¨ TG</a>`:''}
    ${t.cg?.listed&&t.cg.cgId?`<a class="lnk lnk-cg" href="https://coingecko.com/en/coins/${t.cg.cgId}" target="_blank">ü¶é CG</a>`:''}
  </div>`;
}

function genBars(dp){const b=[];for(let i=0;i<5;i++)b.push(8+i*17);b.push(94,89);const bot=Math.max(7,Math.round(94*(1-dp/100)));b.push(68,44,28,bot+5,bot+2,bot,bot+3,bot+7);return b;}

function updateSummary(){
  const n=tokens.length,en=tokens.filter(t=>t.timing?.cls==='g').length,wa=tokens.filter(t=>t.timing?.cls==='w').length,cg=tokens.filter(t=>t.cg?.listed).length,xa=tokens.filter(t=>t.hasX).length;
  const avgD=n?Math.round(tokens.reduce((a,t)=>a+t.dropPct,0)/n):0;
  const avgU=n?(tokens.reduce((a,t)=>a+t.upsideToPeak,0)/n).toFixed(1):'--';
  document.getElementById('sTotal').textContent=n;document.getElementById('sEnter').textContent=en;document.getElementById('sWatch').textContent=wa;document.getElementById('sCG').textContent=cg;document.getElementById('sX').textContent=xa;document.getElementById('sAvgDrop').textContent='-'+avgD+'%';document.getElementById('sAvgUp').textContent=avgU+'x';document.getElementById('foundCt').textContent=n;document.getElementById('cgCt').textContent=cg;
}

function copyCA(addr,btn){navigator.clipboard.writeText(addr).catch(()=>{});const o=btn.textContent;btn.textContent='‚úì Copied!';setTimeout(()=>btn.textContent=o,1500);}
function filt(f,btn){activeF=f;document.querySelectorAll('.fb').forEach(b=>b.classList.remove('act'));btn.classList.add('act');if(tokens.length)renderGrid();}
function doRefresh(){cdSecs=300;tokens=[];fetchAll();}

setInterval(()=>{cdSecs--;const m=Math.floor(cdSecs/60),s=cdSecs%60;const el=document.getElementById('cd');if(el)el.textContent=m+':'+(s<10?'0':'')+s;if(cdSecs<=0){cdSecs=300;doRefresh();}},1000);

fetchAll();
</script>
</body>
</html>
