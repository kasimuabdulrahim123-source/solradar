<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SolRadar v6 ‚Äî Alpha Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#04060d;--bg2:#080c18;--bg3:#0c1220;
  --border:#161f33;--border2:#1e2d47;
  --green:#0dff8c;--yellow:#ffc233;--red:#ff3d5a;
  --blue:#3d8eff;--purple:#9c5fff;--cyan:#00e5ff;
  --gold:#ffd700;--text:#dce8f5;--text2:#526180;--text3:#8a9ab5;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;}
body{font-family:'Manrope',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(13,255,140,0.015) 1px,transparent 1px),linear-gradient(90deg,rgba(13,255,140,0.015) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
body::after{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 60% 40% at 10% 0%,rgba(61,142,255,0.05) 0%,transparent 70%),radial-gradient(ellipse 40% 50% at 90% 100%,rgba(13,255,140,0.04) 0%,transparent 70%);pointer-events:none;z-index:0;}
header{position:sticky;top:0;z-index:200;height:54px;display:flex;align-items:center;justify-content:space-between;padding:0 14px;background:rgba(4,6,13,0.98);backdrop-filter:blur(24px);border-bottom:1px solid var(--border);}
.logo{font-family:'Bebas Neue',sans-serif;font-size:21px;letter-spacing:2px;color:var(--green);text-shadow:0 0 20px rgba(13,255,140,0.4);display:flex;align-items:center;gap:7px;}
.logo-dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:lglow 2s infinite;}
@keyframes lglow{0%,100%{box-shadow:0 0 4px var(--green),0 0 12px var(--green)}50%{box-shadow:0 0 8px var(--green),0 0 28px var(--green)}}
.hstats{display:flex;gap:3px;align-items:center;flex-wrap:wrap;}
.hp{display:flex;align-items:center;gap:3px;padding:3px 7px;border-radius:4px;background:var(--bg2);border:1px solid var(--border);font-family:'DM Mono',monospace;font-size:9px;color:var(--text3);}
.hp.g{border-color:rgba(13,255,140,0.25);color:var(--green);background:rgba(13,255,140,0.05);}
.hp.gold{border-color:rgba(255,215,0,0.2);color:var(--gold);}
.hp.r{border-color:rgba(255,61,90,0.2);color:var(--red);}
.hp.b{border-color:rgba(61,142,255,0.2);color:var(--blue);}
.hp.p{border-color:rgba(156,95,255,0.2);color:var(--purple);}
.hp.c{border-color:rgba(0,229,255,0.2);color:var(--cyan);}
.blink{animation:bl 1s step-end infinite;}@keyframes bl{50%{opacity:0}}
.scan-bar{height:2px;background:linear-gradient(90deg,transparent,var(--green),transparent);background-size:200% 100%;animation:scan 2s linear infinite;}
@keyframes scan{from{background-position:-100% 0}to{background-position:100% 0}}
.mbar{display:flex;gap:4px;padding:5px 14px;background:rgba(8,12,24,0.95);border-bottom:1px solid var(--border);overflow-x:auto;align-items:center;}
.mbar::-webkit-scrollbar{height:0;}
.mbi{display:flex;align-items:center;gap:4px;padding:3px 8px;border-radius:4px;background:var(--bg3);border:1px solid var(--border);white-space:nowrap;font-family:'DM Mono',monospace;font-size:9px;flex-shrink:0;}
.mbl{color:var(--text2);}
.mbv{font-weight:600;}
.up{color:var(--green)!important;}
.dn{color:var(--red)!important;}
.ne{color:var(--text3)!important;}
.tpill{flex-shrink:0;padding:3px 9px;border-radius:4px;font-family:'DM Mono',monospace;font-size:9px;font-weight:700;margin-left:auto;}
.tp-g{background:rgba(13,255,140,0.08);border:1px solid rgba(13,255,140,0.3);color:var(--green);}
.tp-w{background:rgba(255,194,51,0.08);border:1px solid rgba(255,194,51,0.3);color:var(--yellow);}
.tp-b{background:rgba(255,61,90,0.08);border:1px solid rgba(255,61,90,0.3);color:var(--red);}
.nstrip{display:flex;gap:3px;padding:4px 14px;border-bottom:1px solid var(--border);overflow-x:auto;align-items:center;background:rgba(5,8,16,0.95);}
.nstrip::-webkit-scrollbar{height:0;}
.nlbl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);white-space:nowrap;flex-shrink:0;margin-right:2px;}
.nt{padding:2px 6px;border-radius:8px;font-family:'DM Mono',monospace;font-size:7px;font-weight:700;white-space:nowrap;flex-shrink:0;}
.nt-h{background:rgba(255,61,90,0.1);color:var(--red);border:1px solid rgba(255,61,90,0.2);}
.nt-r{background:rgba(13,255,140,0.1);color:var(--green);border:1px solid rgba(13,255,140,0.2);}
.nt-c{background:transparent;color:var(--text2);border:1px solid var(--border);}
.nt-d{background:transparent;color:var(--text2);border:1px solid var(--border);text-decoration:line-through;opacity:0.45;}
.utc-bar{display:flex;align-items:center;gap:6px;padding:4px 14px;border-bottom:1px solid var(--border);background:rgba(6,9,18,0.9);font-family:'DM Mono',monospace;font-size:8px;}
.utc-label{color:var(--text2);}
.utc-peak{color:var(--green);font-weight:700;}
.utc-low{color:var(--red);font-weight:700;}
.utc-norm{color:var(--yellow);font-weight:700;}
.utc-divider{width:1px;height:12px;background:var(--border2);margin:0 3px;}
.tabnav{display:flex;border-bottom:1px solid var(--border);background:var(--bg);position:sticky;top:54px;z-index:150;overflow-x:auto;}
.tabnav::-webkit-scrollbar{height:2px;}
.tab{padding:8px 12px;font-family:'DM Mono',monospace;font-size:9px;font-weight:500;color:var(--text2);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.15s;letter-spacing:1px;text-transform:uppercase;display:flex;align-items:center;gap:4px;white-space:nowrap;}
.tab.t1{color:var(--red);border-bottom-color:var(--red);background:rgba(255,61,90,0.03);}
.tab.t2{color:var(--purple);border-bottom-color:var(--purple);background:rgba(156,95,255,0.03);}
.tab.t3{color:var(--cyan);border-bottom-color:var(--cyan);background:rgba(0,229,255,0.03);}
.tab.t4{color:var(--blue);border-bottom-color:var(--blue);background:rgba(61,142,255,0.03);}
.tab.t5{color:var(--yellow);border-bottom-color:var(--yellow);background:rgba(255,194,51,0.03);}
.tcb{padding:1px 4px;border-radius:6px;font-size:8px;font-weight:700;}
.tc1{background:rgba(255,61,90,0.15);color:var(--red);}
.tc2{background:rgba(156,95,255,0.15);color:var(--purple);}
.tc3{background:rgba(0,229,255,0.15);color:var(--cyan);}
.tc4{background:rgba(61,142,255,0.15);color:var(--blue);}
.app{position:relative;z-index:1;display:grid;grid-template-columns:1fr 268px;height:calc(100vh - 148px);}
.cpanel{overflow-y:auto;}
.cpanel::-webkit-scrollbar{width:3px;}
.cpanel::-webkit-scrollbar-thumb{background:var(--border2);}
.rpanel{border-left:1px solid var(--border);overflow-y:auto;display:flex;flex-direction:column;}
.rpanel::-webkit-scrollbar{width:3px;}
.rpanel::-webkit-scrollbar-thumb{background:var(--border2);}
.sec-hdr{padding:10px 14px 5px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px;}
.sec-title{font-family:'Bebas Neue',sans-serif;font-size:19px;letter-spacing:1px;}
.sec-desc{font-size:10px;color:var(--text2);padding:0 14px 6px;line-height:1.5;}
.rbtn{padding:3px 9px;border-radius:4px;border:1px solid rgba(13,255,140,0.3);background:rgba(13,255,140,0.05);color:var(--green);font-family:'DM Mono',monospace;font-size:9px;cursor:pointer;}
.rbtn:hover{background:rgba(13,255,140,0.1);}
.fbar{padding:5px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:3px;flex-wrap:wrap;}
.srch{background:var(--bg3);border:1px solid var(--border2);border-radius:4px;padding:4px 7px;color:var(--text);font-family:'Manrope',sans-serif;font-size:10px;width:100px;outline:none;}
.srch:focus{border-color:var(--green);}
.srch::placeholder{color:var(--text2);}
.fb{padding:2px 6px;border-radius:3px;border:1px solid var(--border2);background:var(--bg3);color:var(--text3);font-size:8px;font-weight:700;font-family:'DM Mono',monospace;cursor:pointer;transition:all 0.12s;}
.fb:hover,.fb.act{border-color:var(--green);color:var(--green);background:rgba(13,255,140,0.06);}
.mc-badge{margin-left:auto;font-family:'DM Mono',monospace;font-size:8px;padding:2px 6px;border-radius:3px;}
.mc1{background:rgba(255,61,90,0.07);border:1px solid rgba(255,61,90,0.2);color:var(--red);}
.mc2{background:rgba(156,95,255,0.07);border:1px solid rgba(156,95,255,0.2);color:var(--purple);}
.mc3{background:rgba(0,229,255,0.07);border:1px solid rgba(0,229,255,0.2);color:var(--cyan);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(318px,1fr));gap:9px;padding:9px 14px 14px;}
.card{border-radius:9px;padding:11px;transition:transform 0.15s,box-shadow 0.15s;position:relative;overflow:hidden;animation:cIn 0.3s ease forwards;opacity:0;}
@keyframes cIn{from{opacity:0;transform:translateY(7px)}to{opacity:1;transform:translateY(0)}}
.ca{background:var(--bg2);border:1px solid rgba(255,61,90,0.22);}
.ca::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--red),transparent);}
.ca:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(255,61,90,0.08);}
.ca.top{background:rgba(255,61,90,0.022);}
.cg{background:var(--bg2);border:1px solid rgba(156,95,255,0.2);}
.cg::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--purple),transparent);}
.cg:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(156,95,255,0.07);}
.cg.top{background:rgba(156,95,255,0.018);}
.cw{background:var(--bg2);border:1px solid rgba(0,229,255,0.18);}
.cw::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--cyan),transparent);}
.cw:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,229,255,0.07);}
.cw.top{background:rgba(0,229,255,0.016);}
.ct{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;}
.ctl{display:flex;align-items:center;gap:7px;}
.clogo{width:32px;height:32px;border-radius:50%;background:var(--bg3);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.cname{font-weight:700;font-size:12px;}
.ctick{font-family:'DM Mono',monospace;font-size:9px;color:var(--text2);}
.cmeta{font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);margin-top:1px;}
.ctr{text-align:right;}
.cscore{font-family:'Bebas Neue',sans-serif;font-size:26px;line-height:1;}
.ccat{font-family:'DM Mono',monospace;font-size:8px;margin-top:1px;}
.sg3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:3px;margin-bottom:5px;}
.sg2{display:grid;grid-template-columns:1fr 1fr;gap:3px;margin-bottom:5px;}
.si{background:var(--bg3);border-radius:4px;padding:4px 5px;text-align:center;}
.sv{font-family:'DM Mono',monospace;font-size:10px;font-weight:500;}
.sl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-top:1px;text-transform:uppercase;letter-spacing:.3px;}
.sigs{display:flex;gap:2px;flex-wrap:wrap;margin-bottom:5px;}
.sig{padding:1px 4px;border-radius:3px;font-size:7px;font-weight:700;font-family:'DM Mono',monospace;}
.s-alpha{background:rgba(255,61,90,0.1);color:var(--red);border:1px solid rgba(255,61,90,0.2);}
.s-smart{background:rgba(61,142,255,0.1);color:var(--blue);border:1px solid rgba(61,142,255,0.2);}
.s-vol{background:rgba(13,255,140,0.1);color:var(--green);border:1px solid rgba(13,255,140,0.2);}
.s-tg{background:rgba(156,95,255,0.1);color:var(--purple);border:1px solid rgba(156,95,255,0.2);}
.s-wave{background:rgba(0,229,255,0.1);color:var(--cyan);border:1px solid rgba(0,229,255,0.2);}
.s-hold{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.2);}
.s-add{background:rgba(0,229,255,0.12);color:var(--cyan);border:1px solid rgba(0,229,255,0.25);}
.s-exit{background:rgba(255,61,90,0.12);color:var(--red);border:1px solid rgba(255,61,90,0.25);}
.s-bot{background:rgba(255,61,90,0.08);color:var(--red);border:1px solid rgba(255,61,90,0.18);}
.s-cabal{background:rgba(255,61,90,0.14);color:var(--red);border:1px solid rgba(255,61,90,0.3);}
.s-nar{background:rgba(156,95,255,0.1);color:var(--purple);border:1px solid rgba(156,95,255,0.2);}
.s-vir{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.2);}
.s-acc{background:rgba(13,255,140,0.1);color:var(--green);border:1px solid rgba(13,255,140,0.2);}
.s-cg{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.25);}
.s-dh{background:rgba(13,255,140,0.1);color:var(--green);border:1px solid rgba(13,255,140,0.2);}
.s-ph{background:rgba(255,61,90,0.1);color:var(--red);border:1px solid rgba(255,61,90,0.2);}
.s-ph2{background:rgba(255,194,51,0.1);color:var(--yellow);border:1px solid rgba(255,194,51,0.2);}
.safety{display:flex;gap:2px;flex-wrap:wrap;margin-bottom:5px;}
.stag{padding:1px 4px;border-radius:3px;font-size:7px;font-weight:700;font-family:'DM Mono',monospace;}
.st-ok{background:rgba(13,255,140,0.08);color:var(--green);border:1px solid rgba(13,255,140,0.18);}
.st-w{background:rgba(255,194,51,0.08);color:var(--yellow);border:1px solid rgba(255,194,51,0.18);}
.st-b{background:rgba(255,61,90,0.08);color:var(--red);border:1px solid rgba(255,61,90,0.18);}
.tbox{padding:5px 7px;border-radius:5px;margin-bottom:5px;display:flex;align-items:center;gap:5px;}
.tb-g{background:rgba(13,255,140,0.05);border:1px solid rgba(13,255,140,0.2);}
.tb-w{background:rgba(255,194,51,0.05);border:1px solid rgba(255,194,51,0.2);}
.tb-b{background:rgba(255,61,90,0.05);border:1px solid rgba(255,61,90,0.2);}
.tba{font-family:'Bebas Neue',sans-serif;font-size:13px;}
.tbr{font-family:'DM Mono',monospace;font-size:8px;color:var(--text3);margin-top:1px;flex:1;}
.pbox{padding:4px 7px;border-radius:4px;background:var(--bg3);border:1px solid var(--border2);margin-bottom:5px;display:flex;align-items:center;justify-content:space-between;}
.pbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);}
.pbv{font-family:'DM Mono',monospace;font-size:9px;font-weight:700;}
.cgbox{padding:6px 8px;border-radius:5px;margin-bottom:5px;}
.cgbox-listed{background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);}
.cgbox-not{background:rgba(82,97,128,0.05);border:1px solid var(--border);}
.cg-title{font-family:'DM Mono',monospace;font-size:7px;text-transform:uppercase;letter-spacing:1px;margin-bottom:3px;}
.cg-row{display:flex;gap:4px;flex-wrap:wrap;}
.cg-stat{background:var(--bg3);border-radius:3px;padding:3px 6px;text-align:center;}
.cg-sv{font-family:'DM Mono',monospace;font-size:9px;font-weight:600;}
.cg-sl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-top:1px;}
.hbox{padding:6px 8px;border-radius:5px;background:var(--bg3);margin-bottom:5px;}
.hbox-title{font-family:'DM Mono',monospace;font-size:7px;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:4px;}
.hbar{display:flex;height:6px;border-radius:3px;overflow:hidden;margin-bottom:4px;}
.hbar-dh{background:var(--green);}
.hbar-mh{background:var(--yellow);}
.hbar-ph{background:var(--red);}
.hdesc{font-family:'DM Mono',monospace;font-size:8px;line-height:1.4;}
.accum-box{padding:5px 7px;border-radius:5px;margin-bottom:5px;}
.acc-yes{background:rgba(13,255,140,0.04);border:1px solid rgba(13,255,140,0.2);}
.acc-no{background:rgba(82,97,128,0.04);border:1px solid var(--border);}
.acc-title{font-family:'DM Mono',monospace;font-size:7px;text-transform:uppercase;letter-spacing:1px;margin-bottom:2px;}
.acc-desc{font-family:'DM Mono',monospace;font-size:8px;line-height:1.4;}
.insider-box{background:var(--bg3);border-radius:5px;padding:6px 8px;margin-bottom:5px;}
.ib-title{font-family:'DM Mono',monospace;font-size:7px;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:3px;}
.ib-row{font-family:'DM Mono',monospace;font-size:9px;margin-bottom:2px;}
.exit-alert{padding:5px 7px;border-radius:4px;background:rgba(255,61,90,0.07);border:1px solid rgba(255,61,90,0.25);margin-bottom:5px;font-family:'DM Mono',monospace;font-size:8px;color:var(--red);}
.factors{margin-bottom:5px;}
.fl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:3px;}
.fg{display:grid;grid-template-columns:1fr 1fr;gap:3px;}
.fi{background:var(--bg3);border-radius:4px;padding:4px 6px;display:flex;align-items:center;justify-content:space-between;}
.fil{display:flex;align-items:center;gap:3px;}
.fin{font-size:8px;color:var(--text3);font-weight:600;}
.fir{display:flex;align-items:center;gap:3px;}
.fbw{width:26px;height:2px;background:var(--border2);border-radius:2px;overflow:hidden;}
.fb2{height:100%;border-radius:2px;}
.fsc{font-family:'DM Mono',monospace;font-size:8px;font-weight:600;}
.fst{font-family:'DM Mono',monospace;font-size:6px;padding:1px 3px;border-radius:2px;font-weight:700;}
.fs-hot{background:rgba(13,255,140,0.12);color:var(--green);}
.fs-ris{background:rgba(0,229,255,0.12);color:var(--cyan);}
.fs-mid{background:rgba(255,194,51,0.12);color:var(--yellow);}
.fs-low{background:rgba(255,61,90,0.12);color:var(--red);}
.cfooter{display:flex;justify-content:space-between;align-items:center;padding-top:6px;border-top:1px solid var(--border);margin-top:4px;}
.clinks{display:flex;gap:2px;}
.clink{padding:2px 5px;border-radius:3px;border:1px solid var(--border);color:var(--text2);font-size:8px;text-decoration:none;font-family:'DM Mono',monospace;transition:all 0.1s;}
.clink:hover{border-color:var(--cyan);color:var(--cyan);}
.clink.pump{border-color:rgba(156,95,255,0.3);color:var(--purple);}
.ccopy{padding:2px 5px;border-radius:3px;border:1px solid var(--border2);background:var(--bg3);color:var(--text3);font-size:8px;cursor:pointer;font-family:'DM Mono',monospace;}
.ccopy:hover{border-color:var(--green);color:var(--green);}
.alpha-badge{display:flex;align-items:center;gap:4px;padding:4px 7px;border-radius:5px;background:rgba(255,61,90,0.07);border:1px solid rgba(255,61,90,0.22);margin-bottom:6px;}
.ab-txt{font-family:'DM Mono',monospace;font-size:9px;color:var(--red);font-weight:700;}
.ab-time{font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);margin-left:auto;}
.wrow{display:flex;align-items:center;gap:4px;padding:4px 6px;border-radius:4px;background:var(--bg3);margin-bottom:3px;}
.wname{font-family:'DM Mono',monospace;font-size:9px;font-weight:600;}
.wtype{font-size:8px;color:var(--text2);}
.wact{font-size:7px;padding:1px 4px;border-radius:3px;font-family:'DM Mono',monospace;font-weight:700;margin-left:auto;}
.wa-buy{background:rgba(13,255,140,0.1);color:var(--green);border:1px solid rgba(13,255,140,0.2);}
.wa-add{background:rgba(0,229,255,0.1);color:var(--cyan);border:1px solid rgba(0,229,255,0.2);}
.wa-hold{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.2);}
.wa-sell{background:rgba(255,61,90,0.1);color:var(--red);border:1px solid rgba(255,61,90,0.2);}
.mini-chart{margin-bottom:5px;}
.mc-lbl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-bottom:2px;text-transform:uppercase;letter-spacing:.8px;}
.bars{display:flex;align-items:flex-end;gap:2px;height:28px;}
.bar{flex:1;border-radius:2px 2px 0 0;min-height:2px;}
.lstate{display:flex;flex-direction:column;align-items:center;justify-content:center;height:220px;gap:10px;}
.spin{width:30px;height:30px;border:2px solid var(--border2);border-top-color:var(--green);border-radius:50%;animation:sp 0.7s linear infinite;}
@keyframes sp{to{transform:rotate(360deg)}}
.stxt{font-family:'DM Mono',monospace;font-size:10px;color:var(--text2);text-align:center;line-height:1.6;}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:170px;gap:6px;}
.ei{font-size:30px;opacity:0.25;}
.et{font-family:'DM Mono',monospace;font-size:10px;color:var(--text2);text-align:center;line-height:1.6;}
.rphead{padding:7px 11px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.rphead h3{font-family:'DM Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--text2);text-transform:uppercase;}
.rpi{padding:7px 10px;border-bottom:1px solid rgba(22,31,51,0.5);animation:rIn 0.3s ease;}
@keyframes rIn{from{opacity:0;transform:translateX(6px)}to{opacity:1;transform:translateX(0)}}
.rpi-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2px;}
.rpi-name{font-weight:700;font-size:10px;}
.rpi-time{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);}
.rpi-msg{font-size:9px;color:var(--text3);line-height:1.4;}
.rpi-sub{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-top:1px;}
.ri-alpha .rpi-name{color:var(--red);}
.ri-gem .rpi-name{color:var(--purple);}
.ri-wave .rpi-name{color:var(--cyan);}
.ri-exit .rpi-name{color:var(--red);}
.ri-wallet .rpi-name{color:var(--blue);}
.ri-cg .rpi-name{color:var(--gold);}
.wi-sec{padding:9px 14px;}
.wi-title{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;margin-bottom:6px;}
.wi-card{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:9px;margin-bottom:7px;}
.wi-top{display:flex;align-items:center;gap:7px;margin-bottom:6px;}
.wi-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:3px;margin-bottom:5px;}
.wi-stat{background:var(--bg3);border-radius:3px;padding:3px 5px;text-align:center;}
.wi-sv{font-family:'DM Mono',monospace;font-size:10px;font-weight:600;}
.wi-sl{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-top:1px;}
.wi-fp{background:var(--bg3);border-radius:4px;padding:5px 7px;margin-bottom:4px;}
.wi-fp-title{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:3px;}
.wi-fp-row{display:flex;justify-content:space-between;font-family:'DM Mono',monospace;font-size:8px;margin-bottom:2px;}
.wi-new{display:flex;align-items:center;gap:5px;padding:5px 7px;background:rgba(13,255,140,0.04);border:1px solid rgba(13,255,140,0.15);border-radius:5px;margin-bottom:5px;}
.wi-new-txt{font-family:'DM Mono',monospace;font-size:9px;color:var(--green);}
.wi-new-sub{font-size:8px;color:var(--text3);margin-top:1px;}
.lbar{margin:9px 14px;padding:8px 11px;background:var(--bg2);border:1px solid var(--border2);border-radius:7px;display:flex;gap:6px;align-items:center;}
.linput{flex:1;background:var(--bg3);border:1px solid var(--border2);border-radius:4px;padding:4px 8px;color:var(--text);font-family:'DM Mono',monospace;font-size:10px;outline:none;}
.linput:focus{border-color:var(--green);}
.linput::placeholder{color:var(--text2);}
.lbtn{padding:4px 11px;border-radius:4px;border:1px solid rgba(13,255,140,0.3);background:rgba(13,255,140,0.07);color:var(--green);font-family:'DM Mono',monospace;font-size:10px;cursor:pointer;}
.lresult{margin:0 14px 9px;padding:11px;background:var(--bg2);border:1px solid rgba(13,255,140,0.2);border-radius:7px;display:none;}
.lresult.show{display:block;animation:fadeUp 0.3s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.lr-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:5px;margin:7px 0;}
.lr-item{background:var(--bg3);border-radius:4px;padding:6px;}
.lr-label{font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:2px;}
.lr-val{font-family:'DM Mono',monospace;font-size:10px;font-weight:500;}
.grok-box{margin:0 14px 9px;padding:10px;background:var(--bg2);border:1px solid rgba(61,142,255,0.2);border-radius:7px;}
.grok-title{font-family:'Bebas Neue',sans-serif;font-size:15px;color:var(--blue);letter-spacing:1px;margin-bottom:5px;}
.grok-desc{font-size:10px;color:var(--text3);margin-bottom:7px;line-height:1.5;}
.grok-row{display:flex;gap:6px;align-items:center;}
.grok-input{flex:1;background:var(--bg3);border:1px solid var(--border2);border-radius:4px;padding:4px 8px;color:var(--text);font-family:'DM Mono',monospace;font-size:10px;outline:none;}
.grok-input:focus{border-color:var(--blue);}
.grok-input::placeholder{color:var(--text2);}
.grok-save{padding:4px 10px;border-radius:4px;border:1px solid rgba(61,142,255,0.3);background:rgba(61,142,255,0.07);color:var(--blue);font-family:'DM Mono',monospace;font-size:10px;cursor:pointer;}
.grok-status{font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);margin-top:5px;}
@media(max-width:1100px){.app{grid-template-columns:1fr}.rpanel{display:none}}
@media(max-width:680px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <div class="logo"><div class="logo-dot"></div>SOLRADAR <span style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);margin-left:2px;font-weight:400">v6 ALPHA</span></div>
  <div class="hstats">
    <div class="hp g"><span class="blink">‚óè</span>&nbsp;<span id="liveCount">Scanning...</span></div>
    <div class="hp b">SOL <span id="solPrice" style="color:var(--green);margin-left:2px">$--</span><span id="solChg" style="margin-left:2px">--</span></div>
    <div class="hp">BTC <span id="btcPrice" style="margin-left:2px">$--</span></div>
    <div class="hp gold">F&G <span id="fgVal" style="margin-left:2px">--</span></div>
    <div class="hp r">üö®<span id="alphaCount">0</span></div>
    <div class="hp p">üíé<span id="gemCount">0</span></div>
    <div class="hp c">üåä<span id="waveCount">0</span></div>
    <div class="hp" id="apiSt">‚ü≥</div>
    <div class="hp">‚è±<span id="cdTimer">5:00</span></div>
  </div>
</header>
<div class="scan-bar"></div>
<div class="mbar">
  <div class="mbi"><span class="mbl">SOL 24h</span><span class="mbv" id="sol24h">--</span></div>
  <div class="mbi"><span class="mbl">BTC 24h</span><span class="mbv" id="btc24h">--</span></div>
  <div class="mbi"><span class="mbl">Fear/Greed</span><span class="mbv" id="fgLabel">--</span></div>
  <div class="mbi"><span class="mbl">SW Window</span><span class="mbv" id="swWindow" style="color:var(--cyan)">--h</span></div>
  <div class="mbi"><span class="mbl">Wallets</span><span class="mbv" id="wCount" style="color:var(--blue)">--</span></div>
  <div class="mbi"><span class="mbl">Discovered</span><span class="mbv" id="wNew" style="color:var(--green)">0 today</span></div>
  <div class="mbi"><span class="mbl">CG Verified</span><span class="mbv" id="cgVerCount" style="color:var(--gold)">0</span></div>
  <div class="tpill" id="mktTiming">‚ü≥ Analyzing...</div>
</div>
<div class="nstrip" id="nstrip">
  <span class="nlbl">üî• HOT:</span>
</div>
<div class="utc-bar">
  <span class="utc-label">UTC Trading Window:</span>
  <span id="utcStatus" class="utc-peak">--</span>
  <div class="utc-divider"></div>
  <span class="utc-label">Your local time:</span>
  <span id="localTime" style="color:var(--text3)">--</span>
  <div class="utc-divider"></div>
  <span id="utcAdvice" style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text2)">--</span>
</div>
<div class="tabnav">
  <div class="tab t1" onclick="showTab('alpha',this)" id="tab-alpha">üö® Alpha <span class="tcb tc1" id="tc-alpha">0</span></div>
  <div class="tab" onclick="showTab('gems',this)" id="tab-gems">üíé Gems <span class="tcb tc2" id="tc-gems">0</span></div>
  <div class="tab" onclick="showTab('wave',this)" id="tab-wave">üåä Second Wave <span class="tcb tc3" id="tc-wave">0</span></div>
  <div class="tab" onclick="showTab('wallets',this)" id="tab-wallets">üß† Wallet Intel <span class="tcb tc4" id="tc-wallets">0</span></div>
  <div class="tab" onclick="showTab('lookup',this)" id="tab-lookup">üîç Lookup</div>
</div>
<div class="app">
 <div class="cpanel">
  <!-- ALPHA -->
  <div id="page-alpha">
    <div class="sec-hdr">
      <div style="display:flex;align-items:center;gap:6px">
        <span class="sec-title" style="color:var(--red)">üö® Alpha Signals</span>
        <span style="font-family:'DM Mono',monospace;font-size:7px;padding:2px 5px;border-radius:3px;background:rgba(255,61,90,0.1);border:1px solid rgba(255,61,90,0.25);color:var(--red)">FRONT-RUN KOL CALLS</span>
      </div>
      <button class="rbtn" onclick="manualRefresh()">‚ü≥ Refresh</button>
    </div>
    <div class="sec-desc">Proven wallets just bought before posting on X. Get in before their followers see the call. Updated every 5 minutes.</div>
    <div class="fbar">
      <input class="srch" type="text" placeholder="üîç Search..." id="alphaQ" oninput="renderAlpha()">
      <button class="fb act" onclick="sf('alpha','all',this)">ALL</button>
      <button class="fb" onclick="sf('alpha','elite',this)">üëë ELITE</button>
      <button class="fb" onclick="sf('alpha','multi',this)">üî• MULTI</button>
      <button class="fb" onclick="sf('alpha','dev',this)">üõ† DEV</button>
      <button class="fb" onclick="sf('alpha','cg',this)">ü¶é CG LISTED</button>
      <span class="mc1 mc-badge">MC $2K‚Üí$2M</span>
    </div>
    <div id="alpha-load" class="lstate"><div class="spin"></div><div class="stxt" id="alphaTxt">Scanning for proven wallet activity...</div></div>
    <div class="grid" id="alphaGrid" style="display:none"></div>
  </div>
  <!-- GEMS -->
  <div id="page-gems" style="display:none">
    <div class="sec-hdr">
      <div style="display:flex;align-items:center;gap:6px">
        <span class="sec-title" style="color:var(--purple)">üíé Pump.fun Gems</span>
        <span style="font-family:'DM Mono',monospace;font-size:7px;padding:2px 5px;border-radius:3px;background:rgba(156,95,255,0.1);border:1px solid rgba(156,95,255,0.2);color:var(--purple)">LIVE DISCOVERY</span>
      </div>
      <button class="rbtn" onclick="manualRefresh()">‚ü≥ Refresh</button>
    </div>
    <div class="sec-desc">Fresh tokens with Twitter + Telegram + real community. Demand zone entry. CoinGecko dual-listing check. Narrative matched to hot trends.</div>
    <div class="fbar">
      <input class="srch" type="text" placeholder="üîç Search gems..." id="gemQ" oninput="renderGems()">
      <button class="fb act" onclick="sf('gem','all',this)">ALL</button>
      <button class="fb" onclick="sf('gem','buyzone',this)">BUY ZONE</button>
      <button class="fb" onclick="sf('gem','demand',this)">üìâ DEMAND</button>
      <button class="fb" onclick="sf('gem','boosted',this)">üî• BOOSTED</button>
      <button class="fb" onclick="sf('gem','tg',this)">‚úàÔ∏è TG 500+</button>
      <button class="fb" onclick="sf('gem','cg',this)">ü¶é CG LISTED</button>
      <button class="fb" onclick="sf('gem','dh',this)">üíé DIAMOND HANDS</button>
      <span class="mc2 mc-badge">MC $2K‚Üí$500K</span>
    </div>
    <div class="grid" id="gemGrid"></div>
  </div>
  <!-- WAVE -->
  <div id="page-wave" style="display:none">
    <div class="sec-hdr">
      <div style="display:flex;align-items:center;gap:6px">
        <span class="sec-title" style="color:var(--cyan)">üåä Second Wave</span>
        <span style="font-family:'DM Mono',monospace;font-size:7px;padding:2px 5px;border-radius:3px;background:rgba(0,229,255,0.08);border:1px solid rgba(0,229,255,0.2);color:var(--cyan)" id="swWindowLabel">6-24h WINDOW</span>
      </div>
      <button class="rbtn" onclick="manualRefresh()">‚ü≥ Refresh</button>
    </div>
    <div class="sec-desc">Tokens that pumped then pulled back. Accumulation phase detection. Insider still holding check. Exit signals. Best entry time from real SOL price + Fear &amp; Greed.</div>
    <div class="fbar">
      <input class="srch" type="text" placeholder="üîç Search..." id="waveQ" oninput="renderWave()">
      <button class="fb act" onclick="sf('wave','all',this)">ALL</button>
      <button class="fb" onclick="sf('wave','enter',this)">‚úÖ ENTER NOW</button>
      <button class="fb" onclick="sf('wave','accum',this)">üîÑ ACCUMULATING</button>
      <button class="fb" onclick="sf('wave','adding',this)">üìà INSIDERS ADDING</button>
      <button class="fb" onclick="sf('wave','holding',this)">üíé INSIDERS HOLDING</button>
      <button class="fb" onclick="sf('wave','cg',this)">ü¶é CG LISTED</button>
      <span class="mc3 mc-badge">MC $69K‚Üí$2M</span>
    </div>
    <div class="grid" id="waveGrid"></div>
  </div>
  <!-- WALLETS -->
  <div id="page-wallets" style="display:none">
    <div class="sec-hdr">
      <span class="sec-title" style="color:var(--blue)">üß† Wallet Intelligence</span>
      <button class="rbtn" onclick="discoverWallets()">üîç Discover New</button>
    </div>
    <div class="sec-desc">Self-learning wallet tracker. Auto-discovers new alpha wallets from every 2x+ token. Tracks behavior fingerprint ‚Äî not just address. Detects wallet changes automatically.</div>
    <div class="wi-sec" id="wiContent"></div>
  </div>
  <!-- LOOKUP -->
  <div id="page-lookup" style="display:none">
    <div class="sec-hdr"><span class="sec-title" style="color:var(--yellow)">üîç Contract Lookup</span></div>
    <div class="lbar">
      <input class="linput" type="text" placeholder="Paste Solana contract address..." id="lookupIn">
      <button class="lbtn" onclick="doLookup()">üîç Analyze</button>
    </div>
    <div class="lresult" id="lookupResult"></div>
    <!-- GROK SETTINGS -->
    <div class="grok-box">
      <div class="grok-title">ü§ñ Grok X Sentiment (Optional)</div>
      <div class="grok-desc">Add your Grok API key to get real X sentiment, KOL detection, and bot farm filtering for each token. $25 free credits on signup. Our usage costs ~$3-13/month after free credits.</div>
      <div class="grok-row">
        <input class="grok-input" type="password" placeholder="xai-xxxxxxxxxxxxxxxxxxxxxxxx" id="grokKey">
        <button class="grok-save" onclick="saveGrokKey()">Save Key</button>
      </div>
      <div class="grok-status" id="grokStatus">No key saved ‚Äî Grok features disabled</div>
    </div>
    <div style="padding:0 14px"><div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Recent Lookups</div><div id="recentLU"></div></div>
  </div>
 </div>
 <!-- RIGHT PANEL -->
 <div class="rpanel">
   <div class="rphead"><h3>üö® Live Feed</h3><span style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text2)" id="feedCt">--</span></div>
   <div id="liveFeed"></div>
 </div>
</div>

<script>
// ============================================================
// CONSTANTS
// ============================================================
const REFRESH = 300;
const MC_GEM_MIN = 2000, MC_GEM_MAX = 500000;
const MC_WAVE_MIN = 69000, MC_WAVE_MAX = 2000000;
const TOP10_GREEN = 30, TOP10_YELLOW = 50;
const EMOJIS = ['üê∂','üê±','üê∏','üêøÔ∏è','üòé','üöÄ','üíé','üî•','‚ö°','üåô','üëë','üß†','ü¶Ö','üê≥','üéØ','üí∞','‚≠ê','üèÜ','ü¶ä','üêØ','üåä','üé™','ü§ñ','üêâ','üé≠'];

// ============================================================
// STATE
// ============================================================
let market = {solPrice:0,solChg:0,btcPrice:0,btcChg:0,fearGreed:50,fgLabel:'Neutral',swHours:6,timing:'neutral',timingLabel:'‚ü≥ Analyzing...'};
let alphaTokens=[], gemTokens=[], waveTokens=[];
let filters = {alpha:'all', gem:'all', wave:'all'};
let cdSecs = REFRESH;
let recentBuys = [];
let recentLU = [];
let newWalletsToday = 0;
let cgVerified = 0;
let discoveryLog = [];
let grokKey = '';

// ============================================================
// WALLET DATABASE ‚Äî Self-learning, localStorage persisted
// ============================================================
const DEFAULT_WALLETS = [
  {addr:'4nvNc7dDEqKKLM4Sr9Kgk3t1of6f8G66kT64VoC95LYh',name:'M A M B A',type:'KOL',tier:'ELITE',winRate:84,wins:21,total:25,avgMC:120000,avgReturn:6.2,lastActive:Date.now(),source:'KOLSCAN',
   fingerprint:{avgBuySOL:3.2,holdHours:18,buysBelow:200000,sellsAbove:400000,alwaysHasTG:true}},
  {addr:'Bi4rd5FH5bYEN8scZ7wevxNZyNmKHdaBcvewdPFxYdLt',name:'theo',type:'KOL',tier:'ELITE',winRate:79,wins:19,total:24,avgMC:95000,avgReturn:5.8,lastActive:Date.now(),source:'KOLSCAN',
   fingerprint:{avgBuySOL:2.8,holdHours:24,buysBelow:150000,sellsAbove:350000,alwaysHasTG:true}},
  {addr:'CECN4BW4DKnbyddkd9FhWVR5dotzKhQr5p7DUPhQ55Du',name:'Megz',type:'KOL',tier:'PROVEN',winRate:76,wins:13,total:17,avgMC:80000,avgReturn:4.9,lastActive:Date.now(),source:'KOLSCAN',
   fingerprint:{avgBuySOL:1.5,holdHours:12,buysBelow:120000,sellsAbove:300000,alwaysHasTG:false}},
  {addr:'JDd3hy3gQn2V982mi1zqhNqUw1GfV2UL6g76STojCJPN',name:'West',type:'WHALE',tier:'PROVEN',winRate:81,wins:17,total:21,avgMC:150000,avgReturn:5.1,lastActive:Date.now(),source:'KOLSCAN',
   fingerprint:{avgBuySOL:8.5,holdHours:36,buysBelow:250000,sellsAbove:500000,alwaysHasTG:true}},
  {addr:'DfXygSm4jCyNCybVYYK6DwvWqjKee8pbDmJGcLWNDXjh',name:'Alpha Hunter',type:'SHARK',tier:'PROVEN',winRate:76,wins:16,total:21,avgMC:70000,avgReturn:7.2,lastActive:Date.now(),source:'MANUAL',
   fingerprint:{avgBuySOL:4.1,holdHours:20,buysBelow:100000,sellsAbove:400000,alwaysHasTG:false}},
  {addr:'3yFwqXBfZY4jBVyzJNRMGet9yjnCCRm5DXFuBHxRPdgm',name:'SOL Whale',type:'WHALE',tier:'PROVEN',winRate:79,wins:15,total:19,avgMC:180000,avgReturn:4.4,lastActive:Date.now(),source:'MANUAL',
   fingerprint:{avgBuySOL:12.0,holdHours:48,buysBelow:300000,sellsAbove:600000,alwaysHasTG:true}},
  {addr:'9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM',name:'Deepwater',type:'SHARK',tier:'PROVEN',winRate:81,wins:13,total:16,avgMC:60000,avgReturn:8.1,lastActive:Date.now(),source:'MANUAL',
   fingerprint:{avgBuySOL:5.5,holdHours:14,buysBelow:80000,sellsAbove:350000,alwaysHasTG:false}},
];

function loadWallets(){try{const s=localStorage.getItem('sr_w_v6');if(s)return JSON.parse(s);}catch(e){}return[...DEFAULT_WALLETS];}
function saveWallets(w){try{localStorage.setItem('sr_w_v6',JSON.stringify(w));}catch(e){}}
let provenWallets = loadWallets();

function loadGrokKey(){try{const k=localStorage.getItem('sr_grok');if(k){grokKey=k;document.getElementById('grokKey').value='‚Ä¢'.repeat(Math.min(k.length,20));document.getElementById('grokStatus').textContent='‚úÖ Grok key saved ‚Äî X sentiment enabled';document.getElementById('grokStatus').style.color='var(--green)';}}catch(e){}}
function saveGrokKey(){const k=document.getElementById('grokKey').value.trim();if(!k){alert('Please enter your Grok API key');return;}grokKey=k;try{localStorage.setItem('sr_grok',k);}catch(e){}document.getElementById('grokStatus').textContent='‚úÖ Grok key saved ‚Äî X sentiment enabled';document.getElementById('grokStatus').style.color='var(--green)';}

// ============================================================
// NARRATIVES
// ============================================================
const NARRATIVES = {
  hot:['AI Agents','Political','Frog/Pepe','Solana Eco','DeSci'],
  rising:['Dog Memes','Gaming','RWA','L2 Memes'],
  cool:['Cat Memes','Celebrity','Food'],
  dead:['Generic Elon','Random Numbers','No Story']
};

function getNarrative(name,ticker){
  const n=(name+' '+ticker).toLowerCase();
  if(n.match(/ai|agent|neural|gpt|agi|robot/)) return{label:'AI Agents',score:95,status:'HOT'};
  if(n.match(/trump|maga|political|america|vote/)) return{label:'Political',score:90,status:'HOT'};
  if(n.match(/frog|pepe|kek|wojak/)) return{label:'Frog/Pepe',score:88,status:'HOT'};
  if(n.match(/sol|solana|phantom/)) return{label:'Solana Eco',score:84,status:'HOT'};
  if(n.match(/sci|research|bio|depin/)) return{label:'DeSci',score:80,status:'HOT'};
  if(n.match(/dog|doge|shib|inu|woof/)) return{label:'Dog Memes',score:72,status:'RISING'};
  if(n.match(/game|play|quest|rpg/)) return{label:'Gaming',score:68,status:'RISING'};
  if(n.match(/cat|kitty|meow/)) return{label:'Cat Memes',score:50,status:'COOL'};
  if(n.match(/elon|musk|tesla/)) return{label:'Elon',score:28,status:'DEAD'};
  return{label:'Viral Meme',score:58,status:'RISING'};
}

function getVirality(name,ticker){
  let s=30;
  if(ticker.length<=3)s+=25;else if(ticker.length<=5)s+=14;else if(ticker.length>=8)s-=10;
  if(name.length<=6)s+=14;else if(name.length<=10)s+=7;
  if(/\d/.test(ticker))s-=10;
  if(ticker===ticker.toUpperCase())s+=8;
  if(name.toLowerCase().match(/fart|poop|bonk|pump|moon|ape|chad|based/))s+=18;
  const nar=getNarrative(name,ticker);
  s+=Math.round(nar.score*0.25);
  return Math.min(99,Math.max(10,s));
}

// ============================================================
// BOT DETECTION
// ============================================================
function detectBot(pair){
  const b1h=pair.txns?.h1?.buys||0,s1h=pair.txns?.h1?.sells||0;
  const v1h=+(pair.volume?.h1)||0,liq=+(pair.liquidity?.usd)||0;
  let bs=0;
  if(liq>0&&v1h/liq>5)bs+=30;
  if(b1h>0&&s1h>0&&Math.abs(b1h-s1h)<2)bs+=25;
  if(b1h>500&&liq<50000)bs+=20;
  if(b1h>0&&s1h>0&&b1h/s1h>10)bs+=15;
  if(bs>=50)return{level:'HIGH',label:'ü§ñ HIGH BOT ACTIVITY',safe:false};
  if(bs>=25)return{level:'MED',label:'‚ö†Ô∏è Some Bot Activity',safe:true};
  return{level:'LOW',label:'‚úÖ Organic Volume',safe:true};
}

// ============================================================
// CABAL DETECTION
// ============================================================
function detectCabal(pair){
  const b5m=pair.txns?.m5?.buys||0,v5m=+(pair.volume?.m5)||0;
  const liq=+(pair.liquidity?.usd)||0;
  const ageM=pair.pairCreatedAt?(Date.now()-pair.pairCreatedAt)/60000:999;
  let cr=0;
  if(ageM<10&&b5m>30)cr+=40;
  if(ageM<10&&v5m>liq*0.5)cr+=30;
  if(b5m>50&&ageM<15)cr+=30;
  if(cr>=60)return{detected:true,label:'üö® CABAL RISK ‚Äî Coordinated snipe'};
  return{detected:false,label:''};
}

// ============================================================
// HOLDER PSYCHOLOGY ‚Äî Diamond vs Paper Hands
// ============================================================
function analyzeHolderPsychology(pair){
  const ch1h=+(pair.priceChange?.h1)||0;
  const ch6h=+(pair.priceChange?.h6)||0;
  const ch24h=+(pair.priceChange?.h24)||0;
  const b1h=pair.txns?.h1?.buys||0,s1h=pair.txns?.h1?.sells||0;
  const b6h=pair.txns?.h6?.buys||0,s6h=pair.txns?.h6?.sells||0;
  const v1h=+(pair.volume?.h1)||0,v6h=+(pair.volume?.h6)||0;

  // Diamond hands: price down but holders not selling
  const sellPressure1h = s1h>0&&b1h>0 ? s1h/(b1h+s1h) : 0.5;
  const sellPressure6h = s6h>0&&b6h>0 ? s6h/(b6h+s6h) : 0.5;

  // If token pumped then pulled back but sells are still low = diamond hands
  const pumpedAndPulledBack = ch24h>40&&ch1h<-5;
  const lowSellPressure = sellPressure1h < 0.35;
  const volStable = v6h>0&&v1h>v6h*0.25&&v1h<v6h*2;

  let dhPct=50, mhPct=30, phPct=20;

  if(pumpedAndPulledBack&&lowSellPressure){
    // Diamond hands dominant ‚Äî not selling into dip
    dhPct=65;mhPct=25;phPct=10;
  } else if(ch1h<-10&&sellPressure1h>0.6){
    // Paper hands selling hard
    dhPct=20;mhPct=30;phPct=50;
  } else if(ch24h>100&&sellPressure1h<0.4){
    // After big pump but holding ‚Äî strong hands
    dhPct=60;mhPct=30;phPct=10;
  } else if(sellPressure6h>0.55){
    // Moderate paper hands
    dhPct=30;mhPct=35;phPct=35;
  }

  const verdict = dhPct>=55?'DIAMOND HANDS üíé':phPct>=45?'PAPER HANDS ‚ö†Ô∏è':'MIXED HANDS';
  const verdictColor = dhPct>=55?'var(--green)':phPct>=45?'var(--red)':'var(--yellow)';
  const desc = dhPct>=55
    ? 'Holders not selling into dip ‚Äî strong conviction, second wave likely'
    : phPct>=45
    ? 'Heavy selling on dips ‚Äî weak hands still exiting, wait for flush out'
    : 'Mixed signals ‚Äî monitor closely before entry';

  return{dhPct,mhPct,phPct,verdict,verdictColor,desc,sellPressure1h,lowSellPressure};
}

// ============================================================
// ACCUMULATION PHASE DETECTION
// ============================================================
function detectAccumulationPhase(pair){
  const ch1h=+(pair.priceChange?.h1)||0;
  const ch6h=+(pair.priceChange?.h6)||0;
  const ch24h=+(pair.priceChange?.h24)||0;
  const b1h=pair.txns?.h1?.buys||0,s1h=pair.txns?.h1?.sells||0;
  const v1h=+(pair.volume?.h1)||0,v6h=+(pair.volume?.h6)||0,v24h=+(pair.volume?.h24)||0;

  // Accumulation phase signs:
  // 1. Price mostly sideways (not crashing, not pumping) after a big move
  // 2. Volume low but STEADY ‚Äî not zero, not spiking
  // 3. More buys than sells but not frenzied
  // 4. Price holding above a support level
  const priceSideways = Math.abs(ch1h) < 5 && Math.abs(ch6h) < 15;
  const prevPumped = ch24h > 30;
  const lowSteadyVol = v1h>0 && v1h < v24h*0.08 && v1h > v24h*0.02;
  const moreBuysThanSells = b1h > s1h*1.1;
  const notCrashing = ch1h > -10;

  const isAccumulating = priceSideways && prevPumped && lowSteadyVol && moreBuysThanSells && notCrashing;
  const isEarlyAccum = prevPumped && notCrashing && moreBuysThanSells && !isAccumulating;

  if(isAccumulating) return{
    phase:'ACCUMULATION',
    label:'üîÑ ACCUMULATION PHASE DETECTED',
    desc:'Price stable, volume steady, more buyers than sellers. Smart money quietly loading. This is Phase 3 ‚Äî the best entry point before second pump.',
    color:'var(--green)',
    score:90
  };
  if(isEarlyAccum) return{
    phase:'EARLY_ACCUM',
    label:'üëÄ Possible Early Accumulation',
    desc:'Signs of accumulation starting. Monitor for confirmation ‚Äî volume should stabilize in next 1-2 hours.',
    color:'var(--yellow)',
    score:65
  };
  return{phase:'NONE',label:'',desc:'',color:'',score:0};
}

// ============================================================
// EXIT SIGNALS
// ============================================================
function getExitSignals(pair, insiderSelling){
  const signals=[];
  const ch1h=+(pair.priceChange?.h1)||0;
  const v1h=+(pair.volume?.h1)||0,v6h=+(pair.volume?.h6)||0;
  const b1h=pair.txns?.h1?.buys||0,s1h=pair.txns?.h1?.sells||0;
  const mc=getRealMC(pair);

  if(insiderSelling) signals.push('üî¥ INSIDER SELLING ‚Äî Exit immediately');
  if(ch1h>30&&v1h<v6h*0.3) signals.push('‚ö†Ô∏è Price rising on dying volume ‚Äî fake pump');
  if(s1h>b1h*2) signals.push('‚ö†Ô∏è Sells 2x buys ‚Äî distribution phase');
  if(mc>1500000) signals.push('‚ö†Ô∏è MC approaching $2M ceiling ‚Äî take profit');
  if(ch1h<-20&&v1h>v6h) signals.push('üî¥ Heavy dump on high volume ‚Äî cut losses');
  return signals;
}

// ============================================================
// COINGECKO ‚Äî Dual listing check (FREE, no API key)
// ============================================================
const cgCache={};
async function checkCoinGecko(addr){
  if(!addr)return{listed:false};
  if(cgCache[addr]&&Date.now()-cgCache[addr].ts<600000)return cgCache[addr].d;
  try{
    const r=await fetch(`https://api.coingecko.com/api/v3/coins/solana/contract/${addr}`);
    if(r.status===404||r.status===429){
      const res={listed:false};
      cgCache[addr]={d:res,ts:Date.now()};return res;
    }
    const d=await r.json();
    const mc=d.market_data?.market_cap?.usd||0;
    const ath=d.market_data?.ath?.usd||0;
    const cur=d.market_data?.current_price?.usd||0;
    const athPct=ath>0&&cur>0?Math.round(((cur-ath)/ath)*100):null;
    const res={
      listed:true,
      cgId:d.id,
      rank:d.market_cap_rank,
      watchlist:d.watchlist_portfolio_users||0,
      communityScore:d.community_score||0,
      liquidityScore:d.liquidity_score||0,
      ath,athPct,
      name:d.name,
      symbol:d.symbol?.toUpperCase(),
    };
    cgCache[addr]={d:res,ts:Date.now()};
    return res;
  }catch(e){
    const res={listed:false};
    cgCache[addr]={d:res,ts:Date.now()};return res;
  }
}

// ============================================================
// TELEGRAM MEMBER COUNT
// ============================================================
const tgCache={};
async function fetchTGMembers(tgLink){
  if(!tgLink)return null;
  const clean=tgLink.replace('https://t.me/','').replace('@','').split('/')[0].split('?')[0];
  if(!clean||clean.length<2)return null;
  if(tgCache[clean]&&Date.now()-tgCache[clean].ts<300000)return tgCache[clean].count;
  try{
    const r=await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent('https://t.me/'+clean)}`);
    const d=await r.json();
    const html=d?.contents||'';
    const m=html.match(/([\d\s,]+)\s*(subscribers|members)/i);
    if(m){const c=parseInt(m[1].replace(/[\s,]/g,''));tgCache[clean]={count:c,ts:Date.now()};return c;}
  }catch(e){}
  tgCache[clean]={count:null,ts:Date.now()};return null;
}

// ============================================================
// RUGCHECK
// ============================================================
const rugCache={};
async function checkRug(addr){
  if(!addr)return{lpLocked:null,mintOff:null,freezeOff:null,rugVerdict:'UNKNOWN',rugScore:null};
  if(rugCache[addr]&&Date.now()-rugCache[addr].ts<300000)return rugCache[addr].d;
  try{
    const r=await fetch(`https://api.rugcheck.xyz/v1/tokens/${addr}/report/summary`);
    const d=await r.json();
    const risks=d?.risks||[];
    const sc=d?.score||0;
    const lp=risks.find(r=>r.name?.toLowerCase().includes('lp')||r.name?.toLowerCase().includes('liquidity'));
    const mint=risks.find(r=>r.name?.toLowerCase().includes('mint'));
    const frz=risks.find(r=>r.name?.toLowerCase().includes('freeze'));
    const res={lpLocked:!lp||lp.level==='info',mintOff:!mint,freezeOff:!frz,rugScore:sc,rugVerdict:sc<500?'SAFE':sc<700?'CAUTION':'DANGER'};
    rugCache[addr]={d:res,ts:Date.now()};return res;
  }catch(e){
    const res={lpLocked:null,mintOff:null,freezeOff:null,rugVerdict:'UNKNOWN',rugScore:null};
    rugCache[addr]={d:res,ts:Date.now()};return res;
  }
}

// ============================================================
// MARKET DATA
// ============================================================
async function fetchMarket(){
  try{
    const r=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana,bitcoin&vs_currencies=usd&include_24hr_change=true');
    const d=await r.json();
    market.solPrice=d?.solana?.usd||0;
    market.solChg=d?.solana?.usd_24h_change||0;
    market.btcPrice=d?.bitcoin?.usd||0;
    market.btcChg=d?.bitcoin?.usd_24h_change||0;
  }catch(e){}
  try{
    const r=await fetch('https://api.alternative.me/fng/?limit=1');
    const d=await r.json();
    const fg=d?.data?.[0];
    if(fg){market.fearGreed=parseInt(fg.value)||50;market.fgLabel=fg.value_classification||'Neutral';}
  }catch(e){}
  const sol=market.solChg,fg=market.fearGreed;
  if(sol>=3){market.swHours=4;market.timing='good';market.timingLabel='‚úÖ ENTER NOW ‚Äî Market bullish';}
  else if(sol>=0){market.swHours=6;market.timing='good';market.timingLabel='‚úÖ GOOD ‚Äî Market stable';}
  else if(sol>=-3){market.swHours=8;market.timing='warn';market.timingLabel='‚ö†Ô∏è CAUTION ‚Äî Market cooling';}
  else{market.swHours=12;market.timing='bad';market.timingLabel='üî¥ WAIT ‚Äî Market dumping';}
  updateMarketUI();
}

function updateMarketFallback(){
  // Called when market fetch fails ‚Äî show safe defaults
  market.solPrice=0; market.solChg=0; market.btcPrice=0;
  market.fearGreed=50; market.fgLabel='Unknown';
  market.swHours=6; market.timing='warn';
  market.timingLabel='‚ö†Ô∏è Market data unavailable';
  updateMarketUI();
}

function updateMarketUI(){
  const sol=market.solChg,btc=market.btcChg,fg=market.fearGreed;
  document.getElementById('solPrice').textContent='$'+market.solPrice.toFixed(2);
  const sc=document.getElementById('solChg');
  sc.textContent=(sol>=0?'+':'')+sol.toFixed(1)+'%';
  sc.style.color=sol>=0?'var(--green)':'var(--red)';
  document.getElementById('btcPrice').textContent='$'+(market.btcPrice/1000).toFixed(1)+'K';
  document.getElementById('fgVal').textContent=fg;
  const s24=document.getElementById('sol24h');
  s24.textContent=(sol>=0?'+':'')+sol.toFixed(1)+'%';
  s24.className='mbv '+(sol>=1?'up':sol<=-1?'dn':'ne');
  const b24=document.getElementById('btc24h');
  b24.textContent=(btc>=0?'+':'')+btc.toFixed(1)+'%';
  b24.className='mbv '+(btc>=1?'up':btc<=-1?'dn':'ne');
  const fgEl=document.getElementById('fgLabel');
  fgEl.textContent=fg+' ‚Äî '+market.fgLabel;
  fgEl.className='mbv '+(fg>=60?'up':fg<=30?'dn':'ne');
  document.getElementById('swWindow').textContent=market.swHours+'‚Äì24h';
  document.getElementById('swWindowLabel').textContent=market.swHours+'‚Äì24h WINDOW';
  document.getElementById('wCount').textContent=provenWallets.length;
  document.getElementById('wNew').textContent=newWalletsToday+' today';
  document.getElementById('cgVerCount').textContent=cgVerified;
  const tm=document.getElementById('mktTiming');
  tm.textContent=market.timingLabel;
  tm.className='tpill '+(market.timing==='good'?'tp-g':market.timing==='warn'?'tp-w':'tp-b');
  // UTC trading window
  const utcH=new Date().getUTCHours();
  const utcEl=document.getElementById('utcStatus');
  const advEl=document.getElementById('utcAdvice');
  if((utcH>=13&&utcH<=17)||(utcH>=19&&utcH<=23)){
    utcEl.textContent='üü¢ PEAK HOURS ('+utcH+':00 UTC)';
    utcEl.className='utc-peak';
    advEl.textContent='US traders active ‚Äî best time to enter. Volume and momentum at peak.';
  } else if(utcH>=2&&utcH<=8){
    utcEl.textContent='üî¥ LOW LIQUIDITY ('+utcH+':00 UTC)';
    utcEl.className='utc-low';
    advEl.textContent='Asia quiet hours ‚Äî bots dominate. Avoid new entries. Good time to research.';
  } else {
    utcEl.textContent='üü° NORMAL HOURS ('+utcH+':00 UTC)';
    utcEl.className='utc-norm';
    advEl.textContent='Moderate activity. Entries OK but wait for US hours for best momentum.';
  }
  document.getElementById('localTime').textContent=new Date().toLocaleTimeString();
  // Narrative strip
  const strip=document.getElementById('nstrip');
  strip.innerHTML='<span class="nlbl">üî• HOT:</span>';
  NARRATIVES.hot.forEach(n=>{const s=document.createElement('span');s.className='nt nt-h';s.textContent=n;strip.appendChild(s);});
  const r=document.createElement('span');r.className='nlbl';r.style.marginLeft='6px';r.textContent='üìà RISING:';strip.appendChild(r);
  NARRATIVES.rising.forEach(n=>{const s=document.createElement('span');s.className='nt nt-r';s.textContent=n;strip.appendChild(s);});
  const d2=document.createElement('span');d2.className='nlbl';d2.style.marginLeft='6px';d2.textContent='üíÄ DEAD:';strip.appendChild(d2);
  NARRATIVES.dead.forEach(n=>{const s=document.createElement('span');s.className='nt nt-d';s.textContent=n;strip.appendChild(s);});
}

// ============================================================
// FORMAT HELPERS
// ============================================================
const fmc=n=>{if(!n||isNaN(n))return'N/A';if(n>=1e9)return'$'+(n/1e9).toFixed(2)+'B';if(n>=1e6)return'$'+(n/1e6).toFixed(2)+'M';if(n>=1e3)return'$'+(n/1e3).toFixed(1)+'K';return'$'+Math.round(n);};
const fpr=n=>{if(!n||isNaN(n))return'N/A';if(n<0.000001)return'$'+n.toExponential(2);if(n<0.01)return'$'+n.toFixed(6);if(n<1)return'$'+n.toFixed(4);return'$'+n.toFixed(2);};
const ago=ms=>{const m=Math.round(ms/60000);if(m<1)return'just now';if(m<60)return m+'m ago';return Math.round(m/60)+'h ago';};
const logo=name=>EMOJIS[Math.abs([...name].reduce((a,c)=>a+c.charCodeAt(0),0))%EMOJIS.length];
const tierIcon=t=>t==='ELITE'?'üëë':t==='PROVEN'?'üî¥':t==='RISING'?'üü°':'üîµ';
const typeColor=t=>t==='KOL'?'var(--purple)':t==='WHALE'?'var(--blue)':t==='SHARK'?'var(--cyan)':t==='DEV'?'var(--green)':'var(--text3)';

// ============================================================
// REAL MC
// ============================================================
function getRealMC(pair){
  const mc=+(pair.marketCap)||0;
  const fdv=+(pair.fdv)||0;
  return mc>0?mc:fdv;
}

// ============================================================
// TIMING SUGGESTION
// ============================================================
function getTiming(opts){
  const sol=market.solChg,fg=market.fearGreed;
  const utcH=new Date().getUTCHours();
  const goodHour=(utcH>=13&&utcH<=17)||(utcH>=19&&utcH<=23);
  let sc=0;
  if(sol>=3)sc+=30;else if(sol>=1)sc+=18;else if(sol>=0)sc+=8;else if(sol>=-2)sc-=15;else sc-=35;
  if(fg>=70)sc+=20;else if(fg>=55)sc+=10;else if(fg>=40)sc+=3;else if(fg<=25)sc-=30;else sc-=15;
  if(goodHour)sc+=15;else if(utcH>=2&&utcH<=8)sc-=20;
  if(opts.insidersAdding)sc+=35;else if(opts.insidersHolding)sc+=18;
  if(opts.insidersSelling)sc-=28;
  if(opts.volumeReviving)sc+=12;
  if(opts.accumPhase)sc+=20;
  if(opts.cgListed)sc+=10;
  if(sc>=70)return{action:'‚úÖ ENTER NOW',cls:'g',reason:`SOL ${sol>=0?'+':''}${sol.toFixed(1)}% ¬∑ F&G:${fg} ¬∑ ${goodHour?'Peak hours':'Good timing'}${opts.insidersAdding?' ¬∑ Insiders adding':opts.insidersHolding?' ¬∑ Insiders holding':''}`};
  if(sc>=40)return{action:'üëÄ WATCH',cls:'w',reason:`Wait for SOL confirmation ¬∑ F&G:${fg} ¬∑ Next peak: ${goodHour?'soon':'13-17 or 19-23 UTC'}`};
  return{action:'üî¥ WAIT',cls:'b',reason:`Market not ready ¬∑ SOL ${sol.toFixed(1)}% ¬∑ F&G:${fg}${opts.insidersSelling?' ¬∑ Insiders selling':''}`};
}

function getPosSize(score,alpha,cgListed){
  const bonus=cgListed?5:0;
  const s=score+bonus;
  if(s>=85&&alpha>=3)return{pct:'3‚Äì5%',label:'HIGH CONVICTION',color:'var(--green)'};
  if(s>=75||alpha>=2)return{pct:'1‚Äì3%',label:'NORMAL POSITION',color:'var(--cyan)'};
  if(s>=60)return{pct:'0.5‚Äì1%',label:'SMALL BET',color:'var(--yellow)'};
  return{pct:'Paper only',label:'SPECULATIVE',color:'var(--text2)'};
}

// ============================================================
// WALLET SIMULATION (in prod: Alchemy RPC)
// ============================================================
let recentWalletBuys=[];
function simulateWalletActivity(){
  recentWalletBuys=[];
  const active=provenWallets.filter(w=>w.tier==='ELITE'||w.tier==='PROVEN');
  const toks=['CEPRYL','FWOG','BONKX','MAMBA','SOLCAT','AIDOG','PEPEX','CHAD','RIBBIT','SOLAPE'];
  const addrs=[
    'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263',
    'A8C3xuqscfmyLrte3VmTqrAq8kgMASius9AFNANwpump',
    'Df6yfrKC8kZE3KNkrHERKzAetSxbrWeniQfyJY4Jpump',
    '7GCihgDB8fe6KNjn2MYtkzZcRjQy3t9GHdC8uHYmW2hr',
  ];
  const ct=2+Math.floor(Math.random()*3);
  for(let i=0;i<ct;i++){
    const w=active[Math.floor(Math.random()*active.length)];
    const tok=toks[Math.floor(Math.random()*toks.length)];
    const addr=addrs[Math.floor(Math.random()*addrs.length)];
    recentWalletBuys.push({
      wallet:w,token:tok,address:addr,
      solAmount:(1+Math.random()*12).toFixed(2),
      mcAtBuy:50000+Math.random()*350000,
      timestamp:Date.now()-(Math.random()*1800000),
      action:Math.random()>0.12?'BUY':'SELL',
    });
  }
}

// ============================================================
// SELF-LEARNING WALLET DISCOVERY
// ============================================================
async function discoverWallets(){
  // Simulate discovering new wallets from 2x+ tokens
  if(Math.random()>0.55){
    const chars='ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz123456789';
    const newAddr=Array.from({length:44},()=>chars[Math.floor(Math.random()*chars.length)]).join('');
    if(!provenWallets.find(w=>w.addr===newAddr)){
      const wins=1+Math.floor(Math.random()*3);
      const total=wins+Math.floor(Math.random()*2);
      const wr=Math.round((wins/total)*100);
      const tier=wins>=3&&wr>=70?'PROVEN':wins>=2?'RISING':'CANDIDATE';
      const types=['KOL','WHALE','SHARK','DEV'];
      const nw={
        addr:newAddr,
        name:`Wallet ${newAddr.slice(0,4)}...${newAddr.slice(-4)}`,
        type:types[Math.floor(Math.random()*types.length)],
        tier,winRate:wr,wins,total,
        avgMC:50000+Math.random()*200000,
        avgReturn:2+Math.random()*7,
        lastActive:Date.now(),
        source:'AUTO-DISCOVERED',
        discoveredAt:Date.now(),
        fingerprint:{avgBuySOL:1+Math.random()*8,holdHours:6+Math.random()*48,buysBelow:100000+Math.random()*200000,sellsAbove:200000+Math.random()*500000,alwaysHasTG:Math.random()>0.5},
      };
      provenWallets.push(nw);
      saveWallets(provenWallets);
      newWalletsToday++;
      discoveryLog.unshift({wallet:nw,reason:'Found as early buyer on 2x+ token',time:Date.now()});
      if(discoveryLog.length>15)discoveryLog.pop();
    }
  }
  // Auto-retire stale wallets (>14 days inactive, CANDIDATE tier)
  provenWallets=provenWallets.filter(w=>{
    const days=(Date.now()-w.lastActive)/86400000;
    return!(days>14&&w.tier==='CANDIDATE');
  });
  saveWallets(provenWallets);
  document.getElementById('wCount').textContent=provenWallets.length;
  document.getElementById('wNew').textContent=newWalletsToday+' today';
  renderWalletIntel();
}

// ============================================================
// DEXSCREENER MULTI-ENDPOINT FETCH
// ============================================================
// fetchDex now inline in fetchAll

// ============================================================
// PAIR ‚Üí BASE OBJECT
// ============================================================
function pairBase(pair){
  const addr=pair.baseToken?.address||'';
  const name=pair.baseToken?.name||'Unknown';
  const ticker=pair.baseToken?.symbol||'???';
  const mc=getRealMC(pair);
  const v24=+(pair.volume?.h24)||0,v1h=+(pair.volume?.h1)||0,v6h=+(pair.volume?.h6)||0;
  const liq=+(pair.liquidity?.usd)||0;
  const price=+(pair.priceUsd)||0;
  const ch24=+(pair.priceChange?.h24)||0,ch6=+(pair.priceChange?.h6)||0,ch1=+(pair.priceChange?.h1)||0;
  const b24=pair.txns?.h24?.buys||0,s24=pair.txns?.h24?.sells||0;
  const b1h=pair.txns?.h1?.buys||0,s1h=pair.txns?.h1?.sells||0;
  const created=pair.pairCreatedAt?(Date.now()-pair.pairCreatedAt):null;
  const ageH=created?Math.round(created/3600000):null;
  const socials=pair.info?.socials||[];
  const twitter=socials.find(s=>s.type==='twitter')?.url||'';
  const telegram=socials.find(s=>s.type==='telegram')?.url||'';
  const boostActive=pair.boosts?.active||0;
  const inDemandZone=ch6<-8&&ch1>0;
  const volumeReviving=v6h>0&&v1h>v6h*0.35;
  const narrative=getNarrative(name,ticker);
  const virality=getVirality(name,ticker);
  const bot=detectBot(pair);
  const cabal=detectCabal(pair);
  const holderPsych=analyzeHolderPsychology(pair);
  const accumPhase=detectAccumulationPhase(pair);
  return{
    address:addr,name,ticker,logo:logo(name),
    mc,v24,v1h,v6h,liq,price,
    ch24,ch6,ch1,b24,s24,b1h,s1h,
    ageH,ageLabel:ageH!==null?(ageH<1?Math.round(ageH*60)+'m':ageH+'h'):'>24h',
    twitter,telegram,hasTwitter:!!twitter,hasTelegram:!!telegram,
    boostActive,inDemandZone,volumeReviving,
    narrative,virality,bot,cabal,holderPsych,accumPhase,
    pairUrl:pair.url||`https://dexscreener.com/solana/${addr}`,
    addrShort:addr?addr.slice(0,4)+'...'+addr.slice(-4):'',
  };
}

// ============================================================
// SCORE TOKEN
// ============================================================
function scoreToken(t,rug,tgMembers,alphaWallets,cgData){
  let community=40;
  if(t.hasTwitter)community+=14;
  if(t.hasTelegram)community+=14;
  if(tgMembers>=2000)community+=18;else if(tgMembers>=500)community+=10;else if(tgMembers>=100)community+=4;
  if(t.boostActive>=5)community+=14;else if(t.boostActive>=1)community+=7;

  let narrative=t.narrative.score;
  if(t.holderPsych.dhPct>=55)narrative+=8;

  let hyping=40;
  if(t.b1h>80)hyping+=22;else if(t.b1h>30)hyping+=12;
  if(t.volumeReviving)hyping+=14;
  if(t.inDemandZone)hyping+=18;
  if(t.accumPhase.phase==='ACCUMULATION')hyping+=15;

  let safety=40;
  if(rug?.rugVerdict==='SAFE')safety=76;else if(rug?.rugVerdict==='CAUTION')safety=50;else if(rug?.rugVerdict==='DANGER')safety=18;
  if(rug?.mintOff)safety+=7;if(rug?.freezeOff)safety+=5;if(rug?.lpLocked)safety+=9;
  if(!t.bot.safe)safety-=22;if(t.cabal.detected)safety-=30;

  const alphaBoost=Math.min(alphaWallets.length*14,35);
  let cgBonus=0;
  if(cgData?.listed){cgBonus+=20;if(cgData.watchlist>=1000)cgBonus+=10;if(cgData.watchlist>=5000)cgBonus+=15;}

  const final=Math.min(99,Math.round(
    community*0.22+narrative*0.18+hyping*0.20+safety*0.15+alphaBoost*0.15+cgBonus*0.10
  )+(alphaWallets.length>=2?7:0));

  const cat=final>=75?'BUY ZONE':final>=50?'WATCHING':'NO-GO';
  const top10Pct=null;// Would come from Alchemy in prod

  return{community,narrative:t.narrative.score,hyping,safety,final,cat,
    top10Pct,lpLocked:rug?.lpLocked!==false,
    mint:rug?!rug.mintOff:true,
    rugVerdict:rug?.rugVerdict||'UNKNOWN',
    tgMembers,alphaWallets,alphaStrength:alphaWallets.length,cgData,
  };
}

// ============================================================
// MAIN FETCH
// ============================================================
async function fetchAll(){
  document.getElementById('apiSt').textContent='‚ü≥ Scanning';
  document.getElementById('alpha-load').style.display='flex';
  document.getElementById('alphaGrid').style.display='none';

  // Always show fallback tokens immediately so screen is never blank
  try{ await fetchMarket(); }catch(e){}
  simulateWalletActivity();
  gemTokens = fallbackGems();
  waveTokens = fallbackWave();
  alphaTokens = buildWalletAlpha();
  showCounts();
  // Show fallback data right away
  document.getElementById('alpha-load').style.display='none';
  document.getElementById('alphaGrid').style.display='grid';
  renderAlpha(); renderGems(); renderWave(); renderWalletIntel(); renderFeed();

  // Now fetch real data in background
  document.getElementById('apiSt').textContent='‚ü≥ Fetching live data...';
  let pairs=[];
  try{
    const urls=[
      'https://api.dexscreener.com/latest/dex/pairs/solana',
      'https://api.dexscreener.com/latest/dex/search?q=pump',
      'https://api.dexscreener.com/latest/dex/search?q=solana+meme',
    ];
    const results = await Promise.allSettled(
      urls.map(u=>fetch(u,{signal:AbortSignal.timeout(8000)}).then(r=>r.json()))
    );
    results.forEach(r=>{
      if(r.status==='fulfilled'){
        const ps=r.value?.pairs||[];
        ps.filter(p=>p.chainId==='solana').forEach(p=>{
          if(!pairs.find(x=>x.pairAddress===p.pairAddress))pairs.push(p);
        });
      }
    });
  }catch(e){ console.warn('DexScreener failed, keeping fallback data'); }

  if(pairs.length===0){
    // No live data ‚Äî stay with fallbacks but mark as offline
    document.getElementById('apiSt').textContent='‚ö†Ô∏è Offline (fallback)';
    showCounts(); renderAlpha(); renderGems(); renderWave(); renderFeed();
    await discoverWallets();
    return;
  }

  // Got real data ‚Äî filter and process
  const stables=['usdc','usdt','wsol','busd','dai'];
  const clean=pairs.filter(p=>{
    const mc=getRealMC(p);
    const liq=+(p.liquidity?.usd)||0;
    const tk=(p.baseToken?.symbol||'').toLowerCase();
    return mc>=MC_GEM_MIN&&liq>=1000&&!stables.includes(tk)&&p.baseToken?.address;
  });

  const walletAddrs=new Set(recentWalletBuys.filter(b=>b.action==='BUY').map(b=>b.address));
  const alphaPairs=clean.filter(p=>walletAddrs.has(p.baseToken?.address));
  const gemPairs=clean.filter(p=>{const mc=getRealMC(p);return mc>=MC_GEM_MIN&&mc<=MC_GEM_MAX;})
    .sort((a,b)=>(+(b.volume?.h1)||0)-(+(a.volume?.h1)||0)).slice(0,14);
  const wavePairs=clean.filter(p=>{
    const mc=getRealMC(p);
    const ageH=p.pairCreatedAt?(Date.now()-p.pairCreatedAt)/3600000:null;
    const ch24=+(p.priceChange?.h24)||0,ch1=+(p.priceChange?.h1)||0;
    return mc>=MC_WAVE_MIN&&mc<=MC_WAVE_MAX&&ageH!==null&&ageH>=market.swHours&&ageH<=24&&ch24>=40&&ch1<-3;
  }).slice(0,10);

  document.getElementById('apiSt').textContent='‚ü≥ Running checks...';

  // Process with LP/CG/TG checks in parallel ‚Äî with timeout safety
  const safeProcess = (p,type) => Promise.race([
    processToken(p,type),
    new Promise(res=>setTimeout(()=>res(null),6000))
  ]);

  const[aT,gT,wT]=await Promise.all([
    Promise.all(alphaPairs.slice(0,6).map(p=>safeProcess(p,'alpha'))),
    Promise.all(gemPairs.map(p=>safeProcess(p,'gem'))),
    Promise.all(wavePairs.map(p=>safeProcess(p,'wave'))),
  ]);

  const walletAlpha = buildWalletAlpha();
  const realAlpha = [...walletAlpha, ...aT.filter(Boolean)].filter((t,i,a)=>a.findIndex(x=>x.address===t.address)===i);
  const realGems = gT.filter(Boolean);
  const realWave = wT.filter(Boolean);

  // Only override fallbacks if we got real results
  if(realAlpha.length) alphaTokens = realAlpha;
  if(realGems.length) gemTokens = realGems;
  if(realWave.length) waveTokens = realWave;

  cgVerified=[...alphaTokens,...gemTokens,...waveTokens].filter(t=>t.cgData?.listed).length;
  document.getElementById('cgVerCount').textContent=cgVerified;
  document.getElementById('apiSt').textContent='‚úÖ Live';
  showCounts();
  renderAlpha(); renderGems(); renderWave(); renderWalletIntel(); renderFeed();
  await discoverWallets();
}

function buildWalletAlpha(){
  return recentWalletBuys.filter(b=>b.action==='BUY').map(b=>{
    const ws=recentWalletBuys.filter(x=>x.address===b.address&&x.action==='BUY').map(x=>x.wallet);
    const nar=getNarrative(b.token,b.token);
    const timing=getTiming({insidersAdding:false,insidersHolding:true,insidersSelling:false,volumeReviving:false,accumPhase:false,cgListed:false});
    const posSize=getPosSize(72,ws.length,false);
    return{
      address:b.address,name:b.token,ticker:b.token,logo:'üö®',
      mc:b.mcAtBuy,v24:0,v1h:0,v6h:0,liq:0,price:0,
      ch24:0,ch6:0,ch1:0,b24:0,s24:0,b1h:0,s1h:0,
      ageH:1,ageLabel:'<1h',
      twitter:'',telegram:'',hasTwitter:false,hasTelegram:false,
      boostActive:0,inDemandZone:false,volumeReviving:false,
      narrative:nar,virality:50,
      bot:{level:'LOW',label:'‚úÖ KOL Signal',safe:true},
      cabal:{detected:false,label:''},
      holderPsych:{dhPct:60,mhPct:30,phPct:10,verdict:'DIAMOND HANDS üíé',verdictColor:'var(--green)',desc:'KOL buying ‚Äî strong hands signal',sellPressure1h:0.2,lowSellPressure:true},
      accumPhase:{phase:'NONE',label:'',desc:'',color:'',score:0},
      pairUrl:`https://dexscreener.com/solana/${b.address}`,
      addrShort:b.address.slice(0,4)+'...'+b.address.slice(-4),
      community:62,narrative_score:nar.score,hyping:65,safety:65,
      final:76,cat:'BUY ZONE',
      top10Pct:null,lpLocked:null,mint:false,rugVerdict:'UNKNOWN',
      tgMembers:null,alphaWallets:ws,alphaStrength:ws.length,
      cgData:{listed:false},
      timing,posSize,
      insidersHolding:true,insidersAdding:false,insidersSelling:false,
      exitSignals:[],isAlpha:true,walletBuy:b,
      desc:`${ws[0]?.name||'KOL'} ${ws.length>1?'+ '+(ws.length-1)+' more':''} just bought ¬∑ ${fmc(b.mcAtBuy)} MC`,
    };
  });
}

function showCounts(){
  document.getElementById('alphaCount').textContent=alphaTokens.length;
  document.getElementById('gemCount').textContent=gemTokens.length;
  document.getElementById('waveCount').textContent=waveTokens.length;
  document.getElementById('tc-alpha').textContent=alphaTokens.filter(t=>t.cat==='BUY ZONE').length;
  document.getElementById('tc-gems').textContent=gemTokens.filter(t=>t.cat==='BUY ZONE').length;
  document.getElementById('tc-wave').textContent=waveTokens.filter(t=>t.cat==='BUY ZONE').length;
  document.getElementById('tc-wallets').textContent=provenWallets.length;
  document.getElementById('liveCount').textContent=(alphaTokens.length+gemTokens.length+waveTokens.length)+' tokens';
}


async function processToken(pair,type){
  const t=pairBase(pair);
  if(!t.address)return null;
  if(t.cabal.detected&&type!=='alpha')return null;
  if(t.bot.level==='HIGH'&&type!=='alpha')return null;
  const[rug,tgMembers,cgData]=await Promise.all([
    checkRug(t.address),
    t.hasTelegram?fetchTGMembers(t.telegram):Promise.resolve(null),
    checkCoinGecko(t.address),
  ]);
  if(type==='gem'&&rug.lpLocked===false)return null;
  const alphaWallets=recentWalletBuys.filter(b=>b.address===t.address&&b.action==='BUY').map(b=>b.wallet);
  let insidersHolding=false,insidersAdding=false,insidersSelling=false;
  if(type==='wave'){
    insidersHolding=Math.random()>0.4;
    insidersAdding=Math.random()>0.7;
    insidersSelling=!insidersHolding&&Math.random()>0.65;
  }
  const exitSignals=getExitSignals(pair,insidersSelling);
  const scores=scoreToken(t,rug,tgMembers||0,alphaWallets,cgData);
  const timing=getTiming({insidersAdding,insidersHolding,insidersSelling,volumeReviving:t.volumeReviving,accumPhase:t.accumPhase.phase==='ACCUMULATION',cgListed:cgData?.listed});
  const posSize=getPosSize(scores.final,alphaWallets.length,cgData?.listed);
  return{
    ...t,...scores,
    rug,tgMembers,alphaWallets,cgData,
    insidersHolding,insidersAdding,insidersSelling,exitSignals,
    timing,posSize,isAlpha:alphaWallets.length>0,
    desc:buildDesc(t,type,alphaWallets,tgMembers,insidersHolding,insidersAdding,cgData),
    priceHistory:type==='wave'?genBars(Math.abs(t.ch1)):null,
  };
}

function buildDesc(t,type,aws,tgM,holding,adding,cg){
  const parts=[];
  if(aws.length)parts.push(`${aws[0].name}${aws.length>1?' + '+(aws.length-1)+' more':''} just bought`);
  if(cg?.listed)parts.push(`ü¶é CoinGecko listed${cg.watchlist?` ¬∑ ${cg.watchlist.toLocaleString()} watching`:''}`);
  if(t.inDemandZone)parts.push('In demand zone ‚Äî buying after pullback');
  if(t.boostActive)parts.push(`Boosted ${t.boostActive}x`);
  if(tgM)parts.push(`${tgM.toLocaleString()} TG members`);
  if(adding)parts.push('Insiders adding more');else if(holding)parts.push('Insiders holding');
  if(t.accumPhase.phase==='ACCUMULATION')parts.push('Accumulation phase detected');
  if(t.holderPsych.dhPct>=55)parts.push('Diamond hands ‚Äî not selling dip');
  if(t.narrative.status==='HOT')parts.push(t.narrative.label+' narrative');
  return parts.join(' ¬∑ ')||`${t.name} ‚Äî ${t.ageLabel} old ¬∑ ${fmc(t.mc)} MC`;
}

function genBars(pb){
  const b=[];
  for(let i=0;i<4;i++)b.push(14+i*7);
  for(let i=0;i<4;i++)b.push(42+i*13);
  b.push(94,86);
  const bot=Math.round(94*(1-(pb||40)/100));
  b.push(Math.max(bot+7,38),Math.max(bot+2,32),Math.max(bot,28),Math.max(bot+6,36),Math.max(bot+15,48));
  return b;
}

// ============================================================
// FALLBACKS
// ============================================================
function fallbackBase(name,ticker,type,mc,ch24,ch1,ageH){
  const nar=getNarrative(name,ticker);
  const t={address:'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263',name,ticker,logo:logo(name),mc,v24:120000,v1h:9000,v6h:4000,liq:45000,price:0.00012,ch24,ch6:-15,ch1,b24:400,s24:160,b1h:55,s1h:22,ageH,ageLabel:ageH+'h',twitter:`https://x.com/${ticker.toLowerCase()}`,telegram:`https://t.me/${ticker.toLowerCase()}`,hasTwitter:true,hasTelegram:true,boostActive:3,inDemandZone:ch1>0&&ch24>30,volumeReviving:true,narrative:nar,virality:getVirality(name,ticker),bot:{level:'LOW',label:'‚úÖ Organic Volume',safe:true},cabal:{detected:false,label:''},pairUrl:`https://dexscreener.com/solana/DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263`,addrShort:'DezX...P263'};
  const psych=analyzeHolderPsychology({priceChange:{h24:ch24,h6:-15,h1:ch1},txns:{h1:{buys:55,sells:22},h6:{buys:200,sells:120}},volume:{h1:9000,h6:4000,h24:120000}});
  const accum=detectAccumulationPhase({priceChange:{h24:ch24,h6:-15,h1:ch1},txns:{h1:{buys:55,sells:22},h6:{buys:200,sells:120}},volume:{h1:9000,h6:4000,h24:120000}});
  const insAdding=type==='wave'&&Math.random()>0.6;
  const insHold=type==='wave'&&Math.random()>0.3;
  const insSell=false;
  const cgData=Math.random()>0.6?{listed:true,rank:Math.floor(Math.random()*8000)+1000,watchlist:Math.floor(Math.random()*3000)+200,communityScore:60+Math.random()*30,athPct:-30}:{listed:false};
  const scores=scoreToken({...t,holderPsych:psych,accumPhase:accum},{lpLocked:true,mintOff:true,freezeOff:true,rugVerdict:'SAFE',rugScore:180},1240,[],cgData);
  const timing=getTiming({insidersAdding:insAdding,insidersHolding:insHold,insidersSelling:insSell,volumeReviving:true,accumPhase:accum.phase==='ACCUMULATION',cgListed:cgData.listed});
  const posSize=getPosSize(scores.final,0,cgData.listed);
  const exits=getExitSignals({priceChange:{h24:ch24,h6:-15,h1:ch1},txns:{h1:{buys:55,sells:22}},volume:{h1:9000,h6:4000},liquidity:{usd:45000},marketCap:mc},insSell);
  return{...t,...scores,holderPsych:psych,accumPhase:accum,rug:{lpLocked:true,mintOff:true,freezeOff:true,rugVerdict:'SAFE',rugScore:180},tgMembers:1240,alphaWallets:[],cgData,timing,posSize,insidersHolding:insHold,insidersAdding:insAdding,insidersSelling:insSell,exitSignals:exits,priceHistory:type==='wave'?genBars(Math.abs(ch1)):null,desc:`${name} ‚Äî ${ageH}h old ¬∑ ${fmc(mc)} MC ¬∑ ${ch24>0?'+':''}${ch24}% pump${cgData.listed?' ¬∑ ü¶é CG Listed':''}`,isAlpha:false};
}

function fallbackGems(){return[
  fallbackBase('Fwog','FWOG','gem',142000,88,12,3),
  fallbackBase('AI Dog','AIDOG','gem',87000,55,7,5),
  fallbackBase('Ribbit','RIBBIT','gem',210000,120,-5,7),
];}
function fallbackWave(){return[
  fallbackBase('Bonk X','BONKX','wave',580000,180,-42,14),
  fallbackBase('Chad Sol','CHADSOL','wave',380000,140,-38,18),
];}

// ============================================================
// HTML BUILDERS
// ============================================================
function sg3(items){return`<div class="sg3">${items.map(i=>`<div class="si"><div class="sv" style="color:${i.color||'var(--text)'}">${i.val}</div><div class="sl">${i.lbl}</div></div>`).join('')}</div>`;}
function sg2(items){return`<div class="sg2">${items.map(i=>`<div class="si"><div class="sv" style="color:${i.color||'var(--text)'}">${i.val}</div><div class="sl">${i.lbl}</div></div>`).join('')}</div>`;}

function safetyHTML(t){
  const t10c=t.top10Pct===null?'st-w':t.top10Pct<=TOP10_GREEN?'st-ok':t.top10Pct<=TOP10_YELLOW?'st-w':'st-b';
  return`<div class="safety">
    ${t.lpLocked?'<span class="stag st-ok">üîí LP LOCKED</span>':t.lpLocked===null?'<span class="stag st-w">üîí LP?</span>':'<span class="stag st-b">üîì LP OPEN</span>'}
    ${t.mint===false?'<span class="stag st-ok">‚úÖ Mint OFF</span>':'<span class="stag st-w">‚ö†Ô∏è Mint ON</span>'}
    ${t.rugVerdict==='SAFE'?'<span class="stag st-ok">üõ°Ô∏è SAFE</span>':t.rugVerdict==='CAUTION'?'<span class="stag st-w">‚ö†Ô∏è CAUTION</span>':t.rugVerdict==='DANGER'?'<span class="stag st-b">üö® DANGER</span>':'<span class="stag st-w">üõ°Ô∏è ?</span>'}
    ${t.top10Pct!==null?`<span class="stag ${t10c}">Top10:${t.top10Pct}%</span>`:''}
    <span class="stag ${t.bot.level==='LOW'?'st-ok':t.bot.level==='MED'?'st-w':'st-b'}">${t.bot.label}</span>
    ${t.cabal.detected?`<span class="stag st-b">${t.cabal.label}</span>`:''}
  </div>`;
}

function timingHTML(t){
  const col=t.timing.cls==='g'?'var(--green)':t.timing.cls==='w'?'var(--yellow)':'var(--red)';
  return`<div class="tbox tb-${t.timing.cls}">
    <div style="font-size:14px">${t.timing.cls==='g'?'‚úÖ':t.timing.cls==='w'?'‚ö†Ô∏è':'üî¥'}</div>
    <div style="flex:1"><div class="tba" style="color:${col}">${t.timing.action}</div><div class="tbr">${t.timing.reason}</div></div>
  </div>`;
}

function posSizeHTML(t){
  return`<div class="pbox"><span class="pbl">üíº Position:</span><span class="pbv" style="color:${t.posSize.color}">${t.posSize.pct} ‚Äî ${t.posSize.label}</span></div>`;
}

function cgHTML(t){
  if(!t.cgData)return'';
  if(t.cgData.listed){
    return`<div class="cgbox cgbox-listed">
      <div class="cg-title" style="color:var(--gold)">ü¶é COINGECKO LISTED ‚Äî Dual Verified ‚úÖ</div>
      <div class="cg-row">
        ${t.cgData.rank?`<div class="cg-stat"><div class="cg-sv" style="color:var(--gold)">#${t.cgData.rank}</div><div class="cg-sl">CG Rank</div></div>`:''}
        ${t.cgData.watchlist?`<div class="cg-stat"><div class="cg-sv" style="color:var(--cyan)">${t.cgData.watchlist.toLocaleString()}</div><div class="cg-sl">Watching</div></div>`:''}
        ${t.cgData.athPct!==null?`<div class="cg-stat"><div class="cg-sv" style="color:${t.cgData.athPct>=-20?'var(--yellow)':'var(--green)'}">${t.cgData.athPct>0?'+':''}${t.cgData.athPct}%</div><div class="cg-sl">vs ATH</div></div>`:''}
        ${t.cgData.communityScore?`<div class="cg-stat"><div class="cg-sv">${Math.round(t.cgData.communityScore)}</div><div class="cg-sl">CG Score</div></div>`:''}
      </div>
    </div>`;
  }
  return`<div class="cgbox cgbox-not"><div class="cg-title" style="color:var(--text2)">ü¶é Not on CoinGecko yet ‚Äî Early stage</div></div>`;
}

function holderPsychHTML(t){
  const hp=t.holderPsych;
  const dhW=hp.dhPct,mhW=hp.mhPct,phW=hp.phPct;
  return`<div class="hbox">
    <div class="hbox-title">Holder Psychology</div>
    <div class="hbar">
      <div class="hbar-dh" style="width:${dhW}%" title="Diamond Hands ${dhW}%"></div>
      <div class="hbar-mh" style="width:${mhW}%" title="Mixed ${mhW}%"></div>
      <div class="hbar-ph" style="width:${phW}%" title="Paper Hands ${phW}%"></div>
    </div>
    <div style="display:flex;justify-content:space-between;font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-bottom:3px">
      <span style="color:var(--green)">üíé ${dhW}% Diamond</span>
      <span style="color:var(--yellow)">${mhW}% Mixed</span>
      <span style="color:var(--red)">üìÑ ${phW}% Paper</span>
    </div>
    <div class="hdesc" style="color:${hp.verdictColor}">${hp.verdict} ‚Äî ${hp.desc}</div>
  </div>`;
}

function accumHTML(t){
  if(!t.accumPhase||t.accumPhase.phase==='NONE')return'';
  return`<div class="accum-box ${t.accumPhase.phase==='ACCUMULATION'?'acc-yes':'acc-yes'}">
    <div class="acc-title" style="color:${t.accumPhase.color}">${t.accumPhase.label}</div>
    <div class="acc-desc" style="color:var(--text3)">${t.accumPhase.desc}</div>
  </div>`;
}

function insiderHTML(t){
  if(!t.insidersHolding&&!t.insidersAdding&&!t.insidersSelling)return'';
  return`<div class="insider-box">
    <div class="ib-title">Insider Status</div>
    ${t.insidersAdding?'<div class="ib-row" style="color:var(--cyan)">üìà Smart wallet ADDING during dip ‚Äî Highest conviction signal</div>':
      t.insidersHolding?'<div class="ib-row" style="color:var(--green)">üíé Smart wallet HOLDING ‚Äî Expects more upside</div>':
      t.insidersSelling?'<div class="ib-row" style="color:var(--red)">üî¥ Smart wallet SELLING ‚Äî Take caution</div>':''}
  </div>`;
}

function exitHTML(t){
  if(!t.exitSignals||!t.exitSignals.length)return'';
  return t.exitSignals.map(s=>`<div class="exit-alert">‚ö†Ô∏è EXIT SIGNAL: ${s}</div>`).join('');
}

function sigsHTML(t,type){
  const sigs=[];
  (t.alphaWallets||[]).slice(0,3).forEach(w=>sigs.push({cls:'s-smart',l:`${tierIcon(w.tier)} ${w.name} (${w.winRate}%WR)`}));
  if(t.insidersAdding)sigs.push({cls:'s-add',l:'üìà Insiders ADDING'});
  else if(t.insidersHolding)sigs.push({cls:'s-hold',l:'üíé Insiders HOLDING'});
  if(t.insidersSelling)sigs.push({cls:'s-exit',l:'üî¥ Insiders SELLING'});
  if(t.inDemandZone)sigs.push({cls:'s-wave',l:'üìâ Demand Zone'});
  if(t.volumeReviving)sigs.push({cls:'s-vol',l:'üìà Vol Reviving'});
  if(t.boostActive>=1)sigs.push({cls:'s-tg',l:`üî• ${t.boostActive} Boosts`});
  if(t.tgMembers>=500)sigs.push({cls:'s-tg',l:`‚úàÔ∏è ${t.tgMembers?.toLocaleString()} TG`});
  if(t.cgData?.listed)sigs.push({cls:'s-cg',l:'ü¶é CG Listed'});
  if(t.cgData?.watchlist>=1000)sigs.push({cls:'s-cg',l:`üëÅ ${t.cgData.watchlist.toLocaleString()} watching`});
  if(t.holderPsych?.dhPct>=55)sigs.push({cls:'s-dh',l:'üíé Diamond Hands'});
  else if(t.holderPsych?.phPct>=45)sigs.push({cls:'s-ph',l:'üìÑ Paper Hands ‚ö†Ô∏è'});
  if(t.accumPhase?.phase==='ACCUMULATION')sigs.push({cls:'s-acc',l:'üîÑ Accumulating'});
  if(t.narrative?.status==='HOT')sigs.push({cls:'s-nar',l:`üìñ ${t.narrative.label}`});
  if(t.virality>=70)sigs.push({cls:'s-vir',l:`‚≠ê Viral ${t.virality}%`});
  if(t.bot.level!=='LOW')sigs.push({cls:'s-bot',l:t.bot.label});
  if(t.cabal.detected)sigs.push({cls:'s-cabal',l:t.cabal.label});
  return`<div class="sigs">${sigs.map(s=>`<span class="sig ${s.cls}">${s.l}</span>`).join('')}</div>`;
}

function factorsHTML(t){
  const items=[
    {icon:'üèòÔ∏è',name:'Community',score:t.community},
    {icon:'üìñ',name:'Narrative',score:Math.min(99,t.narrative||60)},
    {icon:'üì¢',name:'Hyping',score:t.hyping},
    {icon:'üõ°Ô∏è',name:'Safety',score:t.safety},
  ];
  return`<div class="factors"><div class="fl">Signal Breakdown</div><div class="fg">${items.map(f=>{
    const cls=f.score>=75?'fs-hot':f.score>=60?'fs-ris':f.score>=45?'fs-mid':'fs-low';
    const lbl=f.score>=75?'HOT':f.score>=60?'RISING':f.score>=45?'MID':'LOW';
    const bc=f.score>=75?'var(--green)':f.score>=60?'var(--cyan)':f.score>=45?'var(--yellow)':'var(--red)';
    return`<div class="fi"><div class="fil"><span>${f.icon}</span><span class="fin">${f.name}</span></div><div class="fir"><div class="fbw"><div class="fb2" style="width:${f.score}%;background:${bc}"></div></div><span class="fsc" style="color:${bc}">${f.score}</span><span class="fst ${cls}">${lbl}</span></div></div>`;
  }).join('')}</div></div>`;
}

function cfooterHTML(t){
  const dexUrl = t.pairUrl || ('https://dexscreener.com/solana/'+t.address);
  const fullAddr = t.address || '';
  const shortAddr = t.addrShort || (fullAddr ? fullAddr.slice(0,6)+'...'+fullAddr.slice(-6) : 'N/A');
  return`<div class="cfooter">
    <div style="display:flex;align-items:center;gap:4px;flex-wrap:wrap">
      <button class="ccopy-ca" onclick="copyAddr('${fullAddr}',this)">üìã Copy CA</button>
      <span style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);cursor:pointer;user-select:all" title="${fullAddr}">${shortAddr}</span>
    </div>
    <div class="clinks">
      <a class="clink clink-dex" href="${dexUrl}" target="_blank">üìà DEX</a>
      <a class="clink" href="https://pump.fun/coin/${fullAddr}" target="_blank" style="color:var(--purple);border-color:rgba(156,95,255,0.3)">üî• Pump</a>
      <a class="clink" href="https://birdeye.so/token/${fullAddr}" target="_blank">ü¶Ö</a>
      ${t.hasTwitter?`<a class="clink" href="${t.twitter}" target="_blank">ùïè</a>`:''}
      ${t.hasTelegram?`<a class="clink" href="${t.telegram}" target="_blank">TG</a>`:''}
      ${t.cgData?.listed?`<a class="clink" href="https://coingecko.com/en/coins/${t.cgData.cgId||''}" target="_blank" style="color:var(--gold);border-color:rgba(255,215,0,0.3)">ü¶é</a>`:''}
      <a class="clink" href="https://solscan.io/token/${fullAddr}" target="_blank">Scan</a>
    </div>
  </div>`;
}

// ============================================================
// RENDER ALPHA
// ============================================================
function renderAlpha(){
  const q=document.getElementById('alphaQ').value.toLowerCase();
  let list=[...alphaTokens];
  if(filters.alpha==='elite')list=list.filter(t=>t.alphaWallets?.some(w=>w.tier==='ELITE'));
  else if(filters.alpha==='multi')list=list.filter(t=>t.alphaStrength>=2);
  else if(filters.alpha==='dev')list=list.filter(t=>t.alphaWallets?.some(w=>w.type==='DEV'));
  else if(filters.alpha==='cg')list=list.filter(t=>t.cgData?.listed);
  if(q)list=list.filter(t=>t.name.toLowerCase().includes(q)||t.ticker.toLowerCase().includes(q));
  list.sort((a,b)=>b.alphaStrength-a.alphaStrength||b.final-a.final);
  const grid=document.getElementById('alphaGrid');grid.innerHTML='';
  if(!list.length){grid.innerHTML='<div class="empty"><div class="ei">üö®</div><div class="et">No alpha signals yet<br><small>Proven wallets haven\'t bought anything new<br>in the last 30 minutes. Auto-updates every 5 mins.</small></div></div>';return;}
  list.forEach((t,i)=>{
    const wrows=(t.alphaWallets||[]).slice(0,3).map(w=>`<div class="wrow"><span>${tierIcon(w.tier)}</span><div><div class="wname" style="color:${typeColor(w.type)}">${w.name}</div><div class="wtype">${w.type} ¬∑ ${w.winRate}% WR ¬∑ avg ${w.avgReturn?.toFixed(1)}x</div></div><span class="wact wa-buy">BOUGHT</span></div>`).join('');
    const card=document.createElement('div');
    card.className=`card ca${i<2?' top':''}`;
    card.style.animationDelay=(i*45)+'ms';
    card.innerHTML=`
      <div class="ct"><div class="ctl"><div class="clogo">${t.logo}</div><div>
        <div class="cname">${t.name}</div><div class="ctick">$${t.ticker}</div>
        <div class="cmeta" style="color:var(--red)">üö® ${t.alphaStrength} proven wallet${t.alphaStrength!==1?'s':''} bought</div>
      </div></div><div class="ctr">
        <div class="cscore" style="color:${t.cat==='BUY ZONE'?'var(--green)':t.cat==='WATCHING'?'var(--yellow)':'var(--red)'}">${t.final}%</div>
        <div class="ccat" style="color:${t.cat==='BUY ZONE'?'var(--green)':t.cat==='WATCHING'?'var(--yellow)':'var(--red)'}">${t.cat}</div>
      </div></div>
      <div class="alpha-badge"><span style="font-size:11px">üö®</span><span class="ab-txt">FRONT-RUN ‚Äî Before X post</span><span class="ab-time">${ago(Date.now()-(t.walletBuy?.timestamp||Date.now()))}</span></div>
      ${wrows}
      <div style="height:5px"></div>
      ${sg3([{val:fmc(t.mc),lbl:'Real MC',color:'var(--cyan)'},{val:fmc(t.v1h),lbl:'Vol 1h'},{val:(t.ch24>=0?'+':'')+t.ch24.toFixed(1)+'%',lbl:'24h',color:t.ch24>=0?'var(--green)':'var(--red)'}])}
      ${cgHTML(t)}
      ${safetyHTML(t)}
      ${sigsHTML(t,'alpha')}
      ${timingHTML(t)}
      ${posSizeHTML(t)}
      ${holderPsychHTML(t)}
      ${factorsHTML(t)}
      <div style="font-size:9px;color:var(--text3);line-height:1.4;margin-bottom:5px">${t.desc}</div>
      ${cfooterHTML(t)}`;
    grid.appendChild(card);
  });
}

// ============================================================
// RENDER GEMS
// ============================================================
function renderGems(){
  const q=document.getElementById('gemQ').value.toLowerCase();
  let list=[...gemTokens];
  if(filters.gem==='buyzone')list=list.filter(t=>t.cat==='BUY ZONE');
  else if(filters.gem==='demand')list=list.filter(t=>t.inDemandZone);
  else if(filters.gem==='boosted')list=list.filter(t=>t.boostActive>=1);
  else if(filters.gem==='tg')list=list.filter(t=>t.tgMembers>=500);
  else if(filters.gem==='cg')list=list.filter(t=>t.cgData?.listed);
  else if(filters.gem==='dh')list=list.filter(t=>t.holderPsych?.dhPct>=55);
  if(q)list=list.filter(t=>t.name.toLowerCase().includes(q)||t.ticker.toLowerCase().includes(q));
  list.sort((a,b)=>b.final-a.final);
  const grid=document.getElementById('gemGrid');grid.innerHTML='';
  if(!list.length){grid.innerHTML='<div class="empty"><div class="ei">üíé</div><div class="et">No gems found<br><small>Tokens failed safety checks or filters</small></div></div>';return;}
  list.forEach((t,i)=>{
    const card=document.createElement('div');
    card.className=`card cg${i<2?' top':''}`;
    card.style.animationDelay=(i*38)+'ms';
    card.innerHTML=`
      <div class="ct"><div class="ctl"><div class="clogo">${t.logo}</div><div>
        <div class="cname">${t.name}</div><div class="ctick">$${t.ticker}</div>
        <div class="cmeta" style="color:var(--purple)">üî• ${t.ageLabel} old ¬∑ ${t.narrative?.label||'Meme'}</div>
      </div></div><div class="ctr">
        <div class="cscore" style="color:${t.cat==='BUY ZONE'?'var(--green)':t.cat==='WATCHING'?'var(--yellow)':'var(--red)'}">${t.final}%</div>
        <div class="ccat" style="color:${t.cat==='BUY ZONE'?'var(--green)':t.cat==='WATCHING'?'var(--yellow)':'var(--red)'}">${t.cat}</div>
      </div></div>
      ${t.inDemandZone?'<div style="padding:3px 7px;border-radius:4px;background:rgba(0,229,255,0.05);border:1px solid rgba(0,229,255,0.2);font-family:\'DM Mono\',monospace;font-size:8px;color:var(--cyan);margin-bottom:5px">üìâ DEMAND ZONE ‚Äî Good entry point</div>':''}
      ${sg3([{val:fmc(t.mc),lbl:'Real MC',color:'var(--purple)'},{val:fmc(t.v1h),lbl:'Vol 1h'},{val:(t.ch24>=0?'+':'')+t.ch24.toFixed(1)+'%',lbl:'24h',color:t.ch24>=0?'var(--green)':'var(--red)'}])}
      ${sg3([{val:t.tgMembers?t.tgMembers.toLocaleString():'?',lbl:'TG Members',color:t.tgMembers>=500?'var(--green)':undefined},{val:t.virality+'%',lbl:'Viral Score',color:t.virality>=70?'var(--gold)':undefined},{val:t.boostActive>0?t.boostActive+' active':'None',lbl:'DexBoosts',color:t.boostActive>0?'var(--gold)':undefined}])}
      ${cgHTML(t)}
      ${holderPsychHTML(t)}
      ${safetyHTML(t)}
      ${sigsHTML(t,'gem')}
      ${timingHTML(t)}
      ${posSizeHTML(t)}
      ${factorsHTML(t)}
      <div style="font-size:9px;color:var(--text3);line-height:1.4;margin-bottom:5px">${t.desc}</div>
      ${cfooterHTML(t)}`;
    grid.appendChild(card);
  });
}

// ============================================================
// RENDER WAVE
// ============================================================
function renderWave(){
  const q=document.getElementById('waveQ').value.toLowerCase();
  let list=[...waveTokens];
  if(filters.wave==='enter')list=list.filter(t=>t.timing?.cls==='g');
  else if(filters.wave==='accum')list=list.filter(t=>t.accumPhase?.phase==='ACCUMULATION');
  else if(filters.wave==='adding')list=list.filter(t=>t.insidersAdding);
  else if(filters.wave==='holding')list=list.filter(t=>t.insidersHolding);
  else if(filters.wave==='cg')list=list.filter(t=>t.cgData?.listed);
  if(q)list=list.filter(t=>t.name.toLowerCase().includes(q)||t.ticker.toLowerCase().includes(q));
  list.sort((a,b)=>b.final-a.final);
  const grid=document.getElementById('waveGrid');grid.innerHTML='';
  if(!list.length){grid.innerHTML=`<div class="empty"><div class="ei">üåä</div><div class="et">No second wave tokens right now<br><small>Market window: ${market.swHours}‚Äì24h ¬∑ SOL ${market.solChg.toFixed(1)}%</small></div></div>`;return;}
  list.forEach((t,i)=>{
    const maxB=Math.max(...(t.priceHistory||[1]));
    const barHTML=(t.priceHistory||[]).map((v,idx)=>{
      const h=Math.round((v/maxB)*26);
      const isPk=v===maxB,isRec=idx>=(t.priceHistory.length-2);
      const col=isPk?'rgba(13,255,140,0.8)':isRec?'rgba(0,229,255,0.7)':idx<7?'rgba(13,255,140,0.4)':'rgba(255,61,90,0.5)';
      return`<div class="bar" style="height:${h}px;background:${col}"></div>`;
    }).join('');
    const card=document.createElement('div');
    card.className=`card cw${i<2?' top':''}`;
    card.style.animationDelay=(i*42)+'ms';
    card.innerHTML=`
      <div class="ct"><div class="ctl"><div class="clogo">${t.logo}</div><div>
        <div class="cname">${t.name}</div><div class="ctick">$${t.ticker}</div>
        <div class="cmeta">üìà +${t.ch24?.toFixed(0)||0}% pump ¬∑ ${t.ageLabel} old ¬∑ ${fmc(t.mc)} MC</div>
      </div></div><div class="ctr">
        <div class="cscore" style="color:${t.cat==='BUY ZONE'?'var(--cyan)':t.cat==='WATCHING'?'var(--yellow)':'var(--red)'}">${t.final}%</div>
        <div class="ccat" style="color:${t.cat==='BUY ZONE'?'var(--cyan)':t.cat==='WATCHING'?'var(--yellow)':'var(--red)'}">${t.cat}</div>
      </div></div>
      <div class="mini-chart"><div class="mc-lbl">Pump ‚Üí Pullback ‚Üí Entry Zone</div><div class="bars">${barHTML}</div></div>
      ${sg3([{val:(t.ch24>=0?'+':'')+t.ch24?.toFixed(0)+'%',lbl:'Pump',color:'var(--green)'},{val:t.ch1?.toFixed(0)+'%',lbl:'Pullback',color:'var(--red)'},{val:t.ageLabel,lbl:'Age',color:'var(--cyan)'}])}
      ${sg3([{val:fmc(t.mc),lbl:'Real MC',color:'var(--cyan)'},{val:fmc(t.v1h),lbl:'Vol 1h'},{val:fmc(t.liq),lbl:'Liquidity'}])}
      ${exitHTML(t)}
      ${accumHTML(t)}
      ${insiderHTML(t)}
      ${cgHTML(t)}
      ${holderPsychHTML(t)}
      ${timingHTML(t)}
      ${safetyHTML(t)}
      ${sigsHTML(t,'wave')}
      ${posSizeHTML(t)}
      ${factorsHTML(t)}
      <div style="font-size:9px;color:var(--text3);line-height:1.4;margin-bottom:5px">${t.desc}</div>
      ${cfooterHTML(t)}`;
    grid.appendChild(card);
  });
}

// ============================================================
// WALLET INTEL
// ============================================================
function renderWalletIntel(){
  const c=document.getElementById('wiContent');c.innerHTML='';
  if(discoveryLog.length){
    let html='<div class="wi-title" style="color:var(--green)">üîç New Discoveries Today</div>';
    discoveryLog.slice(0,3).forEach(d=>{
      html+=`<div class="wi-new"><span style="font-size:14px">‚ú®</span><div><div class="wi-new-txt">NEW: ${d.wallet.name} ‚Äî ${d.wallet.tier} ${d.wallet.type}</div><div class="wi-new-sub">${d.reason} ¬∑ ${ago(Date.now()-d.time)} ¬∑ Win rate: ${d.wallet.winRate}%</div></div></div>`;
    });
    c.innerHTML+=html;
  }
  ['ELITE','PROVEN','RISING','CANDIDATE'].forEach(tier=>{
    const ws=provenWallets.filter(w=>w.tier===tier);if(!ws.length)return;
    const tColors={ELITE:'var(--gold)',PROVEN:'var(--red)',RISING:'var(--yellow)',CANDIDATE:'var(--blue)'};
    let html=`<div class="wi-title" style="color:${tColors[tier]}">${tierIcon(tier)} ${tier} WALLETS (${ws.length})</div>`;
    ws.forEach(w=>{
      const days=Math.round((Date.now()-w.lastActive)/86400000);
      html+=`<div class="wi-card">
        <div class="wi-top"><span style="font-size:16px">${tierIcon(w.tier)}</span>
          <div><div style="font-weight:700;font-size:12px">${w.name}</div>
            <div style="font-family:'DM Mono',monospace;font-size:8px;color:${typeColor(w.type)}">${w.type} ¬∑ ${w.source} ¬∑ ${days===0?'Active today':days+'d ago'}</div>
          </div>
        </div>
        <div class="wi-stats">
          <div class="wi-stat"><div class="wi-sv" style="color:var(--green)">${w.winRate}%</div><div class="wi-sl">Win Rate</div></div>
          <div class="wi-stat"><div class="wi-sv" style="color:var(--cyan)">${w.wins}/${w.total}</div><div class="wi-sl">Wins/Total</div></div>
          <div class="wi-stat"><div class="wi-sv" style="color:var(--yellow)">${w.avgReturn?.toFixed(1)}x</div><div class="wi-sl">Avg Return</div></div>
          <div class="wi-stat"><div class="wi-sv">${fmc(w.avgMC)}</div><div class="wi-sl">Avg Entry</div></div>
        </div>
        <div class="wi-fp"><div class="wi-fp-title">Behavior Fingerprint</div>
          <div class="wi-fp-row"><span style="color:var(--text3)">Avg buy size</span><span style="color:var(--text)">${w.fingerprint?.avgBuySOL?.toFixed(1)||'?'} SOL</span></div>
          <div class="wi-fp-row"><span style="color:var(--text3)">Buys below MC</span><span style="color:var(--text)">${fmc(w.fingerprint?.buysBelow||0)}</span></div>
          <div class="wi-fp-row"><span style="color:var(--text3)">Avg hold time</span><span style="color:var(--text)">${w.fingerprint?.holdHours?.toFixed(0)||'?'}h</span></div>
          <div class="wi-fp-row"><span style="color:var(--text3)">Always needs TG</span><span style="color:var(--text)">${w.fingerprint?.alwaysHasTG?'Yes':'No'}</span></div>
        </div>
        <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text3);padding:3px 0">${w.addr.slice(0,10)}...${w.addr.slice(-10)} <a href="https://solscan.io/account/${w.addr}" target="_blank" style="color:var(--cyan);text-decoration:none">View ‚Üí</a></div>
      </div>`;
    });
    c.innerHTML+=html;
  });
}

// ============================================================
// LIVE FEED
// ============================================================
function renderFeed(){
  const feed=document.getElementById('liveFeed');feed.innerHTML='';
  const items=[];
  alphaTokens.slice(0,3).forEach(t=>{
    items.push({type:'alpha',name:'$'+t.ticker,time:ago(Date.now()-(t.walletBuy?.timestamp||Date.now())),
      msg:`üö® ${t.alphaStrength} proven wallet${t.alphaStrength!==1?'s':''} bought`,
      sub:`${t.alphaWallets?.[0]?.name||'KOL'} ¬∑ ${t.timing?.action} ¬∑ ${fmc(t.mc)} MC`});
  });
  recentWalletBuys.slice(0,3).forEach(b=>{
    items.push({type:'wallet',name:b.wallet.name,time:ago(Date.now()-b.timestamp),
      msg:`${b.action==='BUY'?'üü¢ Bought':'üî¥ Sold'} ${b.solAmount} SOL of $${b.token}`,
      sub:`${tierIcon(b.wallet.tier)} ${b.wallet.tier} ¬∑ ${b.wallet.winRate}% WR`});
  });
  waveTokens.filter(t=>t.insidersAdding).slice(0,2).forEach(t=>{
    items.push({type:'wave',name:'$'+t.ticker,time:'now',
      msg:'üåä Insiders ADDING during dip ‚Äî Best entry',
      sub:`${t.timing?.action} ¬∑ MC: ${fmc(t.mc)}`});
  });
  waveTokens.filter(t=>t.accumPhase?.phase==='ACCUMULATION').slice(0,1).forEach(t=>{
    items.push({type:'wave',name:'$'+t.ticker,time:'now',
      msg:'üîÑ Accumulation phase detected ‚Äî Phase 3 entry',
      sub:`Before second pump ¬∑ ${fmc(t.mc)} MC`});
  });
  waveTokens.filter(t=>t.insidersSelling).slice(0,1).forEach(t=>{
    items.push({type:'exit',name:'$'+t.ticker,time:'now',
      msg:'üî¥ EXIT SIGNAL ‚Äî Insider selling detected',
      sub:'Consider taking profit now'});
  });
  const cgItems=[...gemTokens,...waveTokens].filter(t=>t.cgData?.listed).slice(0,2);
  cgItems.forEach(t=>{
    items.push({type:'cg',name:'$'+t.ticker,time:'new',
      msg:`ü¶é Dual Listed ‚Äî DexScreener + CoinGecko`,
      sub:`Rank #${t.cgData.rank||'?'} ¬∑ ${t.cgData.watchlist?.toLocaleString()||0} watching`});
  });
  document.getElementById('feedCt').textContent=items.length+' signals';
  items.slice(0,18).forEach((item,i)=>{
    const div=document.createElement('div');
    div.className=`rpi ri-${item.type}`;
    div.style.animationDelay=(i*50)+'ms';
    div.innerHTML=`<div class="rpi-top"><span class="rpi-name">${item.name}</span><span class="rpi-time">${item.time}</span></div><div class="rpi-msg">${item.msg}</div><div class="rpi-sub">${item.sub}</div>`;
    feed.appendChild(div);
  });
}

// ============================================================
// LOOKUP
// ============================================================
async function doLookup(){
  const input=document.getElementById('lookupIn').value.trim();
  if(!input||input.length<30){alert('Enter a valid Solana address');return;}
  const btn=document.querySelector('.lbtn');btn.textContent='‚ü≥ Analyzing...';
  const[rug,market_data,cgData]= await Promise.all([
    checkRug(input),
    fetch(`https://api.dexscreener.com/latest/dex/tokens/${input}`).then(r=>r.json()).catch(()=>({})),
    checkCoinGecko(input),
  ]);
  const pairs=market_data?.pairs||[];
  const best=pairs.sort((a,b)=>(+(b.liquidity?.usd)||0)-(+(a.liquidity?.usd)||0))[0];
  const mc=best?getRealMC(best):0;
  const socials=best?.info?.socials||[];
  const tgLink=socials.find(s=>s.type==='telegram')?.url||'';
  const twitterLink=socials.find(s=>s.type==='twitter')?.url||'';
  const tgMembers=tgLink?await fetchTGMembers(tgLink):null;
  const knownWallet=provenWallets.find(w=>w.addr.toLowerCase()===input.toLowerCase());
  const botInfo=best?detectBot(best):{level:'UNKNOWN',label:'?',safe:null};
  const holderP=best?analyzeHolderPsychology(best):null;
  const result=document.getElementById('lookupResult');
  result.classList.add('show');
  result.innerHTML=`
    <div style="display:flex;align-items:center;gap:7px;margin-bottom:8px">
      <div class="clogo" style="width:34px;height:34px">${knownWallet?tierIcon(knownWallet.tier):'üîç'}</div>
      <div><div style="font-weight:700;font-size:13px">${knownWallet?knownWallet.name:(best?.baseToken?.name||'Token Analysis')}</div>
        <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--text2);word-break:break-all;max-width:260px;margin-top:1px">${input}</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:${rug.lpLocked!==false?'var(--green)':'var(--red)'}">${rug.lpLocked!==false?'‚úÖ PASSES':'‚ùå FAILS'}</div>
      </div>
    </div>
    ${knownWallet?`<div style="padding:5px 7px;background:rgba(61,142,255,0.06);border:1px solid rgba(61,142,255,0.2);border-radius:4px;margin-bottom:7px;font-family:'DM Mono',monospace;font-size:9px;color:var(--blue)">üß† KNOWN: ${knownWallet.tier} ${knownWallet.type} ¬∑ ${knownWallet.winRate}% win rate ¬∑ ${knownWallet.wins}/${knownWallet.total} wins ¬∑ Avg ${knownWallet.avgReturn?.toFixed(1)}x return</div>`:''}
    ${cgData?.listed?`<div style="padding:5px 7px;background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.2);border-radius:4px;margin-bottom:7px;font-family:'DM Mono',monospace;font-size:9px;color:var(--gold)">ü¶é COINGECKO LISTED ‚Äî Rank #${cgData.rank||'?'} ¬∑ ${cgData.watchlist?.toLocaleString()||0} watching ¬∑ ${cgData.athPct!==null?`${cgData.athPct}% vs ATH`:'--'}</div>`:'<div style="padding:5px 7px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;margin-bottom:7px;font-family:\'DM Mono\',monospace;font-size:9px;color:var(--text2)">ü¶é Not on CoinGecko ‚Äî Early stage token</div>'}
    <div class="lr-grid">
      <div class="lr-item"><div class="lr-label">Market Cap</div><div class="lr-val" style="color:var(--cyan)">${fmc(mc)}</div></div>
      <div class="lr-item"><div class="lr-label">LP Lock</div><div class="lr-val" style="color:${rug.lpLocked?'var(--green)':rug.lpLocked===null?'var(--yellow)':'var(--red)'}">${rug.lpLocked?'üîí LOCKED':rug.lpLocked===null?'? UNKNOWN':'üîì OPEN'}</div></div>
      <div class="lr-item"><div class="lr-label">Mint Auth</div><div class="lr-val" style="color:${rug.mintOff?'var(--green)':'var(--red)'}">${rug.mintOff?'‚úÖ OFF':'‚ö†Ô∏è ON'}</div></div>
      <div class="lr-item"><div class="lr-label">Rugcheck</div><div class="lr-val" style="color:${rug.rugVerdict==='SAFE'?'var(--green)':rug.rugVerdict==='CAUTION'?'var(--yellow)':'var(--red)'}">${rug.rugVerdict}</div></div>
      <div class="lr-item"><div class="lr-label">TG Members</div><div class="lr-val" style="color:${tgMembers>=500?'var(--green)':'var(--text3)'}">${tgMembers?tgMembers.toLocaleString():'N/A'}</div></div>
      <div class="lr-item"><div class="lr-label">Bot Activity</div><div class="lr-val" style="color:${botInfo.level==='LOW'?'var(--green)':'var(--red)'}">${botInfo.label}</div></div>
    </div>
    ${holderP?`<div style="margin:5px 0;padding:5px 7px;background:var(--bg3);border-radius:4px;font-family:'DM Mono',monospace;font-size:9px">Holder Psychology: <span style="color:${holderP.verdictColor};font-weight:700">${holderP.verdict}</span> ‚Äî ${holderP.desc}</div>`:''}
    <div style="display:flex;gap:3px;flex-wrap:wrap;margin-top:7px">
      <a class="clink" href="https://solscan.io/token/${input}" target="_blank">üîç Solscan</a>
      <a class="clink" href="https://dexscreener.com/solana/${input}" target="_blank">üìà DEX</a>
      <a class="clink" href="https://birdeye.so/token/${input}" target="_blank">ü¶Ö Birdeye</a>
      <a class="clink" href="https://rugcheck.xyz/tokens/${input}" target="_blank">üõ°Ô∏è Rugcheck</a>
      <a class="clink" href="https://kolscan.io/account/${input}" target="_blank">üß† KOLSCAN</a>
      ${cgData?.listed?`<a class="clink" href="https://coingecko.com/en/coins/${cgData.cgId||''}" target="_blank" style="color:var(--gold);border-color:rgba(255,215,0,0.3)">ü¶é CoinGecko</a>`:''}
      <a class="clink pump" href="https://pump.fun/coin/${input}" target="_blank">üî• Pump.fun</a>
      <button class="ccopy" onclick="copyAddr('${input}',this)">üìã Copy</button>
    </div>`;
  recentLU.unshift({address:input,verdict:rug.lpLocked!==false?'‚úÖ':'‚ùå',mc:fmc(mc),cgListed:cgData?.listed,time:new Date().toLocaleTimeString()});
  if(recentLU.length>5)recentLU.pop();
  renderRecentLU();
  btn.textContent='üîç Analyze';
}

function renderRecentLU(){
  const c=document.getElementById('recentLU');c.innerHTML='';
  recentLU.forEach(l=>{
    const div=document.createElement('div');
    div.style.cssText='padding:6px 8px;background:var(--bg2);border:1px solid var(--border);border-radius:5px;margin-bottom:4px;cursor:pointer;';
    div.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--text3)">${l.address.slice(0,8)}...${l.address.slice(-6)}</span><div style="display:flex;gap:4px"><span style="font-size:9px;color:${l.verdict.includes('‚úÖ')?'var(--green)':'var(--red)'}">${l.verdict}</span>${l.cgListed?'<span style="font-size:9px;color:var(--gold)">ü¶é</span>':''}</div></div><div style="font-family:'DM Mono',monospace;font-size:7px;color:var(--text2);margin-top:2px">${l.time} ¬∑ MC: ${l.mc}</div>`;
    div.onclick=()=>{document.getElementById('lookupIn').value=l.address;doLookup();};
    c.appendChild(div);
  });
}

// ============================================================
// UI UTILS
// ============================================================
function showTab(tab,el){
  ['alpha','gems','wave','wallets','lookup'].forEach(t=>{
    const p=document.getElementById('page-'+t);if(p)p.style.display='none';
    const tb=document.getElementById('tab-'+t);if(tb)tb.className='tab';
  });
  document.getElementById('page-'+tab).style.display='block';
  const cls={alpha:'t1',gems:'t2',wave:'t3',wallets:'t4',lookup:'t5'}[tab]||'';
  document.getElementById('tab-'+tab).className='tab '+cls;
}

function sf(section,f,btn){
  filters[section]=f;
  const pages={alpha:'page-alpha',gem:'page-gems',wave:'page-wave'};
  const pg=pages[section];
  if(pg)document.querySelectorAll('#'+pg+' .fb').forEach(b=>b.classList.remove('act'));
  btn.classList.add('act');
  if(section==='alpha')renderAlpha();
  else if(section==='gem')renderGems();
  else if(section==='wave')renderWave();
}

function manualRefresh(){cdSecs=REFRESH;fetchAll();}

function copyAddr(addr,btn){
  navigator.clipboard.writeText(addr).catch(()=>{});
  const o=btn.textContent;btn.textContent='‚úì Copied!';
  setTimeout(()=>{btn.textContent=o;},1400);
}

// ============================================================
// COUNTDOWN
// ============================================================
setInterval(()=>{
  cdSecs--;
  const m=Math.floor(cdSecs/60),s=cdSecs%60;
  const el=document.getElementById('cdTimer');
  if(el)el.textContent=m+':'+(s<10?'0':'')+s;
  if(cdSecs<=0){cdSecs=REFRESH;fetchAll();}
  // Update local time every second
  const lt=document.getElementById('localTime');
  if(lt)lt.textContent=new Date().toLocaleTimeString();
},1000);

// INIT
loadGrokKey();
fetchAll();
</script>
</body>
</html>
